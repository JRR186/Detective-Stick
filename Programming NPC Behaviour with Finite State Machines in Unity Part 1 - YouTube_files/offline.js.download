(function(g){var window=this;'use strict';var Lyk=function(k){var n=new g.OD("und",new g.Zz("Default","und",!0));n.captionTracks=k.captionTracks;return n},bsO=function(k){return new g.BG(function(n,t){var d=k.length,G=[];
if(d)for(var R=function(x,w){d--;G[x]=w;d==0&&n(G)},O=function(x){t(x)},D,Z=0;Z<k.length;Z++)D=k[Z],g.vD7(D,g.nO(R,Z),O);
else n(G)})},jg=function(k){this.B=k},rp=function(){jg.apply(this,arguments)},mQ_=function(){rp.apply(this,arguments)},y7k=function(){rp.apply(this,arguments)},sNW=function(){rp.apply(this,arguments)},Xc5=function(){rp.apply(this,arguments)},E2K=function(){rp.apply(this,arguments)},UQ7=function(){rp.apply(this,arguments)},BR7=function(){jg.apply(this,arguments)},Ick=function(){rp.apply(this,arguments)},hg_=function(){rp.apply(this,arguments)},Vo_=function(){rp.apply(this,arguments)},A7f=function(){rp.apply(this,
arguments)},WyD=function(){rp.apply(this,arguments)},qwO=function(){rp.apply(this,arguments)},egG=function(){rp.apply(this,arguments)},Hsi=function(){rp.apply(this,arguments)},Fyi=function(){rp.apply(this,arguments)},PpG=function(){rp.apply(this,arguments)},jND=function(){rp.apply(this,arguments)},r7i=function(){rp.apply(this,arguments)},c74=function(){jg.apply(this,arguments)},NRG=function(){rp.apply(this,arguments)},fcO=function(){rp.apply(this,arguments)},QN5=function(){rp.apply(this,arguments)},
zgC=function(){rp.apply(this,arguments)},ac5=function(){rp.apply(this,arguments)},Ky4=function(){rp.apply(this,arguments)},v25=function(){rp.apply(this,arguments)},u14=function(){rp.apply(this,arguments)},Mo5=function(){rp.apply(this,arguments)},g2D=function(){jg.apply(this,arguments)},Cp5=function(){jg.apply(this,arguments)},lc4=function(){jg.apply(this,arguments)},pc4=function(){rp.apply(this,arguments)},Swi=function(){rp.apply(this,arguments)},k$m=function(){rp.apply(this,arguments)},njG=function(){rp.apply(this,
arguments)},t35=function(){rp.apply(this,arguments)},d1C=function(){rp.apply(this,arguments)},G$D=function(){rp.apply(this,arguments)},RW4=function(){rp.apply(this,arguments)},OID=function(){rp.apply(this,arguments)},YED=function(){rp.apply(this,arguments)},oj9=function(){rp.apply(this,arguments)},D1O=function(){rp.apply(this,arguments)},$15=function(){rp.apply(this,arguments)},ZIW=function(){rp.apply(this,arguments)},x1K=function(){rp.apply(this,arguments)},wM_=function(){rp.apply(this,arguments)},
T5D=function(){rp.apply(this,arguments)},iIO=function(){rp.apply(this,arguments)},JJG=function(){rp.apply(this,arguments)},LpD=function(){rp.apply(this,arguments)},bIK=function(){rp.apply(this,arguments)},m1K=function(){rp.apply(this,arguments)},yJ_=function(){rp.apply(this,arguments)},sHi=function(){rp.apply(this,arguments)},XMk=function(){rp.apply(this,arguments)},EjW=function(){rp.apply(this,arguments)},U17=function(){jg.apply(this,arguments)},B5_=function(){rp.apply(this,arguments)},I0K=function(){rp.apply(this,
arguments)},hWm=function(){rp.apply(this,arguments)},V3D=function(){rp.apply(this,arguments)},AJk=function(){rp.apply(this,arguments)},Wpf=function(){rp.apply(this,arguments)},qEf=function(){rp.apply(this,arguments)},eW9=function(){rp.apply(this,arguments)},HI_=function(){rp.apply(this,arguments)},Fpi=function(){rp.apply(this,arguments)},PdW=function(){rp.apply(this,arguments)},jHk=function(){rp.apply(this,arguments)},rJm=function(){rp.apply(this,arguments)},cJW=function(){rp.apply(this,arguments)},
N55=function(){rp.apply(this,arguments)},f05=function(){rp.apply(this,arguments)},QHi=function(){rp.apply(this,arguments)},zWG=function(){rp.apply(this,arguments)},a09=function(){rp.apply(this,arguments)},Kpk=function(){rp.apply(this,arguments)},vj9=function(){rp.apply(this,arguments)},uqO=function(){rp.apply(this,arguments)},M3f=function(){rp.apply(this,arguments)},gjG=function(){rp.apply(this,arguments)},CdD=function(){rp.apply(this,arguments)},l0i=function(){rp.apply(this,arguments)},pMf=function(){rp.apply(this,
arguments)},SE9=function(){rp.apply(this,arguments)},k34=function(){rp.apply(this,arguments)},nzm=function(){rp.apply(this,arguments)},t$m=function(){rp.apply(this,arguments)},dGO=function(){rp.apply(this,arguments)},G35=function(k){k=k.key||k.id;
if(!k)throw Error("Entity key is missing");return k},Rnk=function(){if(cD)return cD();
var k={};cD=g.ti("PersistentEntityStoreDb",{IG:(k.EntityStore={Wp:1},k.EntityAssociationStore={Wp:2},k),shared:!1,upgrade:function(n,t){t(1)&&g.r2(g.qp(n,"EntityStore",{keyPath:"key"}),"entityType","entityType");t(2)&&(n=g.qp(n,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.r2(n,"byParentEntityKey","parentEntityKey"),g.r2(n,"byChildEntityKey","childEntityKey"))},
version:3});return cD()},O1k=function(k){return g.vh(Rnk(),k)},Yr4=function(k){return g.vh((0,g.M2_)(),k)},Nq=function(k){this.token=k},fe=function(k,n){n=n===void 0?{}:n;
g.gf.call(this,g.g9k[k],Object.assign({},{name:"PESEncoderError",type:k},n));this.type=k;this.level="WARNING";Object.setPrototypeOf(this,fe.prototype)},oz5=function(k){return new fe("WRONG_DATA_TYPE",{h4:k})},DG_=function(k){return k instanceof Error?new fe("UNKNOWN_ENCODE_ERROR",{LZ:k.message}):new fe("UNKNOWN_ENCODE_ERROR")},$GG=function(k){return k instanceof Error?new fe("UNKNOWN_DECODE_ERROR",{LZ:k.message}):new fe("UNKNOWN_DECODE_ERROR")},Z1D=function(k,n){k=k instanceof fe?k:n(k);
g.rJ(k);throw k;},xGD=function(){},wVW=function(k,n,t){try{return k.C(n,t)}catch(d){Z1D(d,DG_)}},TiC=function(k){k=(new TextEncoder).encode(k).subarray(0,16);
var n=new Uint8Array(16);n.set(k);return n},Qb=function(k){this.B=k},JH4=function(k){var n=i1k[k];
if(n)return n;g.ce(new g.gf("Entity model not found.",{entityType:k}))},LhO=function(k,n){this.B=k;
this.T=n;this.C={}},mGW=function(k,n){a:{k=b1m(k.T,n.version);
try{var t=k.T(n.data,n.key);break a}catch(d){Z1D(d,$GG)}t=void 0}return t},zi=function(k,n,t){return k.B.objectStore("EntityStore").get(n).then(function(d){if(d){if(t&&d.entityType!==t)throw Error("Incorrect entity type");
return mGW(k,d)}})},aZ=function(k,n,t){return t?(t=t.map(function(d){return zi(k,d,n)}),g.Bh.all(t)):k.B.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(n)).then(function(d){return d.map(function(G){return mGW(k,G)})})},vD=function(k,n,t){var d=G35(n),G=b1m(k.T,1),R=Object.assign({},n);
return k.B.objectStore("EntityStore").get(d).then(function(O){if(O){if(O.entityType!==t)throw Error("Incorrect entity type");R.entityMetadata||(O=mGW(k,O),R.entityMetadata=O.entityMetadata)}}).then(function(){var O={key:d,
entityType:t,data:wVW(G,R,d),version:1};return g.Bh.all([g.Fy(k.B.objectStore("EntityStore"),O),yH4(k,R,t)])}).then(function(){Ke(k,d,t);
return d})},seG=function(k,n,t){n=n.map(function(d){return vD(k,d,t)});
return g.Bh.all(n)},uJ=function(k,n,t){if(t==null?0:t.Xk){var d=new Set;
return XVG(k,n,d).then(function(){for(var R=[],O=g.y(d),D=O.next();!D.done;D=O.next())R.push(uJ(k,D.value));return g.Bh.all(R).then(function(){})})}var G=g.pC(n).entityType;
return g.Bh.all([k.B.objectStore("EntityStore").delete(n),Ezk(k,n)]).then(function(){Ke(k,n,G)})},UG5=function(k,n){return g.QC(k.B.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(n)},function(t){return g.Bh.all([t.delete(),
Ezk(k,t.cursor.primaryKey)]).then(function(){Ke(k,t.cursor.primaryKey,n);return g.Np(t)})})},Bi4=function(k,n,t,d){var G=b1m(k.T,1);
return zi(k,n,d).then(function(R){if(R){R=g.bI(R,t);var O={key:n,entityType:d,data:wVW(G,R,n),version:1};return g.Bh.all([g.Fy(k.B.objectStore("EntityStore"),O),yH4(k,R,d)])}}).then(function(){Ke(k,n,d);
return n})},Ke=function(k,n,t){var d=k.C[t];
d||(d=new Set,k.C[t]=d);d.add(n)},IqD=function(k,n,t){var d=G35(n);
t=JH4(t);if(!t)return g.Bh.resolve([]);t=new t(n);k=k.B.objectStore("EntityAssociationStore");n=[];t=g.y(t.T());for(var G=t.next();!G.done;G=t.next())n.push(g.Fy(k,{parentEntityKey:d,childEntityKey:G.value}));return g.Bh.all(n).then(function(R){return R.map(function(O){return O[1]})})},Ezk=function(k,n){return k.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(n))},yH4=function(k,n,t){var d=G35(n);
return Ezk(k,d).then(function(){return IqD(k,n,t)})},XVG=function(k,n,t){if(t.has(n))return g.Bh.resolve(void 0);
t.add(n);return hnK(k,n).then(function(d){return k.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(n)).then(function(){return d})}).then(function(d){var G=g.Bh.resolve(void 0);
d=g.y(d);for(var R=d.next(),O={};!R.done;O={Lw:void 0},R=d.next())O.Lw=R.value,G=G.then(function(D){return function(){return XVG(k,D.Lw,t)}}(O));
return G}).then(function(){})},hnK=function(k,n){var t=k.B.objectStore("EntityAssociationStore");
return t.index("byParentEntityKey").getAll(IDBKeyRange.only(n)).then(function(d){var G=[];d=g.y(d);for(var R=d.next();!R.done;R=d.next())R=R.value,G.push(t.index("byChildEntityKey").getAll(R.childEntityKey));return g.Bh.all(G)}).then(function(d){var G=[];
d=g.y(d);for(var R=d.next();!R.done;R=d.next())R=R.value,R.length===1&&G.push(R[0].childEntityKey);return G})},Mq=function(){},V$D=function(){this.B={};
this.B[0]=new Mq;if(!g.XO("aes_pes_encoder_killswitch")){var k=this.B;try{var n=g.CP();var t=TiC(n);var d=new Qb(new g.Un(t),new g.En(t))}catch(G){throw k=G instanceof Error?new fe("KEY_CREATION_FAILED",{LZ:G.message}):new fe("KEY_CREATION_FAILED"),g.rJ(k),k;}k[1]=d}},b1m=function(k,n){n=n===void 0?0:n;
k=k.B[n];if(!k)throw n=new fe("INVALID_ENCODER_VERSION",{h4:n}),g.rJ(n),n;return k},gp=function(k,n){g.N.call(this);
this.token=k;this.B=n;this.observers=[];k=new g.Qq.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.CP());k.onmessage=this.T.bind(this);this.channel=k},Ce=function(k,n,t){var d,G,R,O;
return g.H(function(D){if(D.B==1)return g.q(D,O1k(k.token),2);if(D.B!=3)return d=D.T,g.q(D,g.Hh(d,["EntityStore","EntityAssociationStore"],n,function(Z){G=new LhO(Z,k.B);return t(G)}),3);
R=D.T;G&&(O=G.C,Object.keys(O).length>0&&(k.channel.postMessage(O),AH_(k,O)));return D.return(R)})},lJ=function(k,n,t){return Ce(k,{mode:"readwrite",
PC:!0},function(d){return vD(d,n,t)})},WhW=function(k,n){return Ce(k,{mode:"readwrite",
PC:!0},function(t){return seG(t,n,"offlineOrchestrationActionWrapperEntity")})},qr9=function(k,n){return Ce(k,{mode:"readwrite",
PC:!0},function(t){return uJ(t,n)})},enk=function(k){return Ce(k,{mode:"readwrite",
PC:!0},function(n){return UG5(n,"videoPlaybackPositionEntity")})},pe=function(k,n,t){return Ce(k,{mode:"readonly",
PC:!0},function(d){return zi(d,n,t)})},Sg=function(k,n,t){return Ce(k,{mode:"readonly",
PC:!0},function(d){return aZ(d,n,t)})},AH_=function(k,n){k=g.y(k.observers);
for(var t=k.next();!t.done;t=k.next())t=t.value,t(n)},H15=function(){var k,n,t;
return g.H(function(d){if(d.B==1)return g.Xh(d,2),g.q(d,g.kk(),4);if(d.B!=2){k=d.T;if(!k||!g.lT()||typeof g.Qq.BroadcastChannel==="undefined")return d.return();n=new V$D;return d.return(new gp(k,n))}t=g.IJ(d);t instanceof Error&&g.rJ(t);return d.return()})},kP=function(){Fh7||(Fh7=H15());
return Fh7},P79=function(k){var n;
k=(n=k.options)==null?void 0:n.persistenceOption;return k==="ENTITY_PERSISTENCE_OPTION_PERSIST"||k==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},jef=function(k){var n;
return g.H(function(t){return t.B==1?g.q(t,kP(),2):(n=t.T)?g.q(t,Ce(n,"readwrite",function(d){for(var G={},R=g.y(k),O=R.next(),D={};!O.done;D={vg:void 0,zA:void 0},O=R.next())D.vg=O.value,D.vg.entityKey&&P79(D.vg)&&(D.zA=g.Wl(D.vg.payload),O=void 0,D.vg.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(O=function(Z){return function(){return vD(d,Z.vg.payload[Z.zA],Z.zA)}}(D)),D.vg.type==="ENTITY_MUTATION_TYPE_DELETE"&&(O=function(Z){return function(){return uJ(d,Z.vg.entityKey)}}(D)),D.vg.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(O=function(Z){return function(){return Bi4(d,Z.vg.entityKey,Z.vg.payload[Z.zA],Z.zA)}}(D)),O&&(G[D.vg.entityKey]=G[D.vg.entityKey]?G[D.vg.entityKey].then(O):O()));
return g.Bh.all(Object.values(G))}),0):t.return()})},rHk=function(k){var n;
return g.H(function(t){if(t.B==1){n=k.mutations;if(!n||n.length<=0)return t.return();if(g.Ru){var d={type:"ENTITY_LOADED"};n!==void 0&&(d.payload=n);g.Ru.dispatch(d)}return g.q(t,jef(n),2)}n.length=0;g.yq(t)})},cHD=function(k){return k!==void 0},Ni_=function(k){var n=g.ed();
n=Object.assign({},n);k=Object.assign({},k);for(var t in n)k[t]?(n[t]!==4&&(n[t]=k[t]),delete k[t]):n[t]!==2&&(n[t]=4);Object.assign(n,k);g.Sih(n);JSON.stringify(n);return n},fq9=function(k){var n,t;
return g.H(function(d){if(d.B==1)return g.q(d,g.kk(),2);if(d.B!=3)return(n=d.T)?g.q(d,g.PK(n),3):d.return();t=d.T;return d.return(g.Hh(t,["index","media","captions"],{mode:"readwrite",PC:!0},function(G){var R=IDBKeyRange.bound(k+"|",k+"~");G=[G.objectStore("index").delete(R),G.objectStore("media").delete(R),G.objectStore("captions").delete(R)];return g.Bh.all(G).then(function(){})}))})},Qe7=function(){var k,n;
return g.H(function(t){if(t.B==1)return g.q(t,g.kk(),2);if(t.B!=3){k=t.T;if(!k)throw g.E4("rvdfd");return g.q(t,g.PK(k),3)}n=t.T;return t.return(g.Hh(n,["index","media"],{mode:"readwrite",PC:!0},function(d){var G={};return g.ch(d.objectStore("index"),{},function(R){var O=R.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),D=g.Bh.resolve(void 0);if(O){var Z=O[1];O=O[2];G[Z]=G[Z]||{};var x;G[Z][O]=g.Gxw((x=R.getValue())==null?void 0:x.fmts)}else D=R.delete().then(function(){});
return g.Bh.all([g.Np(R),D]).then(function(w){return g.y(w).next().value})}).then(function(){for(var R={},O=g.y(Object.keys(G)),D=O.next();!D.done;D=O.next()){D=D.value;
var Z=G[D].v;R[D]=G[D].a&&Z?1:2}var x=Ni_(R);return g.IE_(d.objectStore("media"),{},function(w){var T=w.cursor.key.match(g.ohb);T&&R[T[1]]||d.objectStore("media").delete(w.cursor.key);return g.L5z(w)}).then(function(){return x})})}))})},znO=function(k,n){var t,d;
return g.H(function(G){if(G.B==1)return g.q(G,g.kk(),2);if(G.B!=3){t=G.T;if(!t)throw g.E4("wct");return g.q(G,g.PK(t),3)}d=G.T;return g.q(G,g.Hh(d,["captions"],{mode:"readwrite",PC:!0},function(R){var O=[];R=R.objectStore("captions");for(var D=0;D<n.length;D++){var Z=g.Fy(R,n[D],k+"|"+n[D].metadata.vss_id);O.push(Z)}return g.Bh.all(O)}),0)})},aqC=function(k){var n,t,d;
return g.H(function(G){if(G.B==1)return n=IDBKeyRange.bound(k+"|",k+"~"),g.q(G,g.kk(),2);if(G.B!=3){t=G.T;if(!t)throw g.E4("gactfv");return g.q(G,g.PK(t),3)}d=G.T;return G.return(d.getAll("captions",n))})},KhC=function(k){return g.H(function(n){g.FI(k,0);
return n.return(fq9(k))})},vzf=function(k){return{context:g.S1(),
videoIds:k}},uf5=function(k){return{context:g.S1(),
playlistIds:k}},M$W=function(k){return{context:g.S1(),
offlinePlaylistSyncChecks:k}},gz5=function(){this.B=new Map},lqO=function(){C75||(C75=new gz5);
return C75},pV5=function(k,n){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:k},metadata:n,statusCode:void 0,csn:void 0,can:void 0}},Sr_=function(k,n,t){if(!t){var d=d===void 0?!1:d;
t=k.B.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!t||d)t=g.In(16),k.B.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",t)}k={flowNonce:t,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:n.eventType};n.metadata&&(k.flowMetadata=n.metadata);n.statusCode!==void 0&&(k.flowEventStatus=n.statusCode);n.csn&&(k.csn=n.csn);n.can&&(k.can=n.can);g.ZH("flowEvent",k,void 0)},kgm=function(k){var n,t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk,DG,yD,I,V,A;
return g.H(function(F){if(F.B==1)return g.q(F,Ce(k,{mode:"readonly",PC:!0},function(r){return aZ(r,"playbackData").then(function(nw){var RJ=nw.map(function(oJ){return oJ.transfer}).filter(function(oJ){return!!oJ}),Ot=nw.map(function(oJ){return oJ.offlineVideoPolicy}).filter(function(oJ){return!!oJ}),c=nw.filter(function(oJ){return!!oJ.key}).map(function(oJ){return g.S5(g.pC(oJ.key).entityId,"downloadStatusEntity")});
RJ=aZ(r,"transfer",RJ);Ot=aZ(r,"offlineVideoPolicy",Ot);c=aZ(r,"downloadStatusEntity",c);var Et=RJ.then(function(oJ){oJ=oJ.reduce(function(D7,PI){(PI==null?0:PI.offlineVideoStreams)&&D7.push.apply(D7,g.U(PI.offlineVideoStreams));return D7},[]).filter(function(D7){return!!D7});
return aZ(r,"offlineVideoStreams",oJ)});
return g.Bh.all([RJ,Ot,Et,c]).then(function(oJ){var D7=g.y(oJ);oJ=D7.next().value;var PI=D7.next().value;var pw=D7.next().value;D7=D7.next().value;return[nw,oJ,PI,pw,D7]})})}),2);
if(F.B!=3)return n=F.T,g.q(F,Ce(k,{mode:"readonly",PC:!0},function(r){return aZ(r,"mainDownloadsListEntity").then(function(nw){var RJ,Ot;return(Ot=(RJ=nw[0])==null?void 0:RJ.downloads)!=null?Ot:[]})}),3);
t=F.T;d=g.y(n);G=d.next().value;R=d.next().value;O=d.next().value;D=d.next().value;Z=d.next().value;x=G;w=R;T=O;J=D;L=Z;b={};E={};B={};h={};W={};e=[];P=g.y(w);for(Q=P.next();!Q.done;Q=P.next())(k$=Q.value)&&(b[k$.key]=k$);M=g.y(T);for(Gb=M.next();!Gb.done;Gb=M.next())(Y$=Gb.value)&&(E[Y$.key]=Y$);S=g.y(L);for(a=S.next();!a.done;a=S.next())(p=a.value)&&(B[p.key]=p);X=g.y(J);for(K=X.next();!K.done;K=X.next())(zb=K.value)&&(h[zb.key]=zb);hk=g.y(t);for(m_=hk.next();!m_.done;m_=hk.next())Vq=m_.value,tk=
void 0,W[(tk=Vq.videoItem)!=null?tk:""]=!0,Vq.videoItem&&(yD=DG=void 0,I=(yD=(DG=g.pC(Vq.videoItem))==null?void 0:DG.entityId)!=null?yD:"",e.push({externalVideoId:I}));V=x.filter(function(r){if(!r||!r.key||!r.offlineVideoPolicy)return!1;r=g.pC(r.key).entityId;r=g.S5(r,"downloadStatusEntity");var nw;return!(r&&((nw=B[r])==null?void 0:nw.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
A=V.map(function(r){var nw=b[r.transfer],RJ=[];if(nw==null?0:nw.offlineVideoStreams)for(var Ot=g.y(nw.offlineVideoStreams),c=Ot.next();!c.done;c=Ot.next())(c=h[c.value])&&RJ.push(c);Ot=E[r.offlineVideoPolicy];c=W;var Et=r==null?void 0:r.playerResponseTimestamp,oJ=g.pC(Ot.key).entityId;r=g.S5(oJ,"mainVideoEntity");if(Ot.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var D7="OFFLINE_VIDEO_STATE_DISABLED";Ot.expirationTimestamp&&Number(Ot.expirationTimestamp)<Date.now()/1E3&&(D7="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Ot.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")D7="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(nw==null?void 0:nw.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":D7="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":D7="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":D7="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":D7="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":D7="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":D7="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:D7="OFFLINE_VIDEO_STATE_UNKNOWN"}if(D7==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(nw==null?void 0:nw.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":D7="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":D7="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":D7=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}oJ={id:oJ,videoState:D7};if(nw==null?0:nw.cotn)oJ.cotn=nw.cotn;if(nw==null?0:nw.maximumDownloadQuality)oJ.selectedVideoQuality=nw==null?void 0:nw.maximumDownloadQuality;if(nw==null?0:nw.lastProgressTimeMs)oJ.lastProgressTimeMs=nw.lastProgressTimeMs;Et&&(oJ.playerResponseSavedTimeMs=String(Number(Et)*1E3));nw=String;Et=0;RJ=g.y(RJ);for(D7=RJ.next();!D7.done;D7=RJ.next())if(D7=D7.value,D7.streamsProgress){D7=g.y(D7.streamsProgress);for(var PI=D7.next();!PI.done;PI=
D7.next()){var pw=void 0;Et+=Number((pw=PI.value.numBytesDownloaded)!=null?pw:0)}}oJ.downloadedBytes=nw(Et);oJ.selectedOfflineMode=c[r]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Ot.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(oJ.offlinePlaybackDisabledReason=Ot.offlinePlaybackDisabledReason);return oJ});
return F.return({offlineVideos:A,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:e}}})})},nsm=function(){this.locks=navigator.locks},tyC=function(){try{var k=g.Kw("ytglobal.locks_");
if(k)return k;var n;if(n=navigator){var t=navigator;n="locks"in t&&!!t.locks}if(n)return g.Qq.localStorage&&g.Qq.localStorage.getItem("noop"),k=new nsm,g.aJ("ytglobal.locks_",k),k}catch(d){}},n3=function(){},dwO=function(){},Gg5=function(k){if(k.includes(":"))throw Error("Invalid user cache name: "+k);
return k+":"+g.CP("CacheStorage get")},R29=function(){return g.H(function(k){if(tO!==void 0)return k.return(tO);
tO=new Promise(function(n){var t;return g.H(function(d){switch(d.B){case 1:return g.Xh(d,2),g.q(d,dn.open("test-only"),4);case 4:return g.q(d,dn.delete("test-only"),5);case 5:g.BI(d,3);break;case 2:if(t=g.IJ(d),t instanceof Error&&t.name==="SecurityError")return n(!1),d.return();case 3:n("caches"in window),g.yq(d)}})});
return k.return(tO)})},YGC=function(){return g.H(function(k){if(k.B==1)return g.q(k,R29(),2);
if(!k.T)return k.return(void 0);OS9||(OS9=new dwO);return k.return(OS9)})},GX=function(k,n,t){g.ce(new g.gf("Woffle: "+k,t?{cotn:t}:""));
n instanceof Error&&g.ce(n)},osk=function(k){var n;
return g.H(function(t){if(t.B==1)return g.q(t,kgm(k),2);n=t.T;g.ZH("offlineStateSnapshot",n);g.yq(t)})},R4=function(k){g.N.call(this);
var n=this;this.api=k;this.fq={KVV:function(){return n.B},
D6f:function(){return n.T}};
typeof g.Qq.BroadcastChannel!=="undefined"&&(this.B=new g.Qq.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.CP()),this.B.onmessage=this.C.bind(this),this.T=new g.Qq.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.CP()),this.T.onmessage=this.S.bind(this))},OF=function(k,n){k.api.A8("onOfflineOperationFailure",n);
var t;(t=k.B)==null||t.postMessage(n)},DwK=function(k,n,t,d){var G=this;
this.X=k;this.K=n;this.visibility=t;this.G=d;this.D=this.W=this.L=this.C=this.B=!1;this.S=new g.CB(function(){G.B_()});
this.fq={cq:function(){return G.T},
B_:function(){G.B_()},
W0H:function(){return G.S}};
this.visibility.subscribe("visibilitystatechange",function(){G.rV()})},$wD=function(k){if(!k.C&&!k.B){var n=tyC();
if(n){k.C=!0;var t=g.CP("OfflineLockManager");n.request("woffle_orchestration_leader:"+t,{},function(){var d,G,R,O;return g.H(function(D){switch(D.B){case 1:return g.Xh(D,2),k.T=new g.Bo,k.B=!0,k.C=!1,g.q(D,k.X(),4);case 4:return g.q(D,k.T.promise,5);case 5:g.BI(D,0);break;case 2:d=g.IJ(D),((R=(G=k).G)==null?0:R.call(G,"wo_relinquish_leadership_on_lock_request_error"))||k.B_(),d instanceof Error&&(O=d,O.args=[{name:"WoLockManagerError",W9:d.name}],g.rJ(O)),g.yq(D)}})})}}},ZSm=function(k){k.B&&(k.D=
!0,YP(k))},xwC=function(k,n){k.B&&(k.L=n,YP(k))},wj5=function(k,n){k.B&&(k.W=n,YP(k))},YP=function(k){k.W&&k.L&&k.D&&k.visibility.isBackground()?g.lk(k.S,6E4):k.S.stop()},o4=function(k){var n;
k.offlineDeleteReason=(n=k.offlineDeleteReason)!=null?n:"OFFLINE_DELETE_REASON_UNKNOWN";var t;k.offlineModeType=(t=k.offlineModeType)!=null?t:"OFFLINE_NOW";g.ZH("offlineDeleteEvent",k)},D2=function(k,n){var t=n.videoId;
var d=n.TP;n=n.offlineModeType;k.encryptedVideoId=t;k.cotn=d==null?void 0:d.cotn;k.offlineabilityFormatType=d==null?void 0:d.maximumDownloadQuality;var G;k.isRefresh=(G=d==null?void 0:d.isRefresh)!=null?G:!1;var R;k.softErrorCount=(R=d==null?void 0:d.transferRetryCount)!=null?R:0;k.offlineModeType=n!=null?n:"OFFLINE_NOW";(k.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&k.statusType==="UNKNOWN_STATUS_TYPE"||!k.transferStatusType&&!k.statusType)&&g.ce(Error("Woffle unknown transfer status"));
g.ZH("offlineTransferStatusChanged",k)},TsO=function(k,n,t,d){d={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!d};n&&t&&(n=Math.floor(n/1024).toFixed(),t=Math.floor(t/1024).toFixed(),d.alreadyDownloadedKbytes=n,d.totalFetchedKbytes=n,d.totalContentKbytes=t);D2(d,k)},iSk=function(k){D2({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},k)},JBO=function(k){switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
$P=function(k){var n,t,d;
return((d=(n=k.actionMetadata)==null?void 0:(t=n.retryScheduleIntervalsInSeconds)==null?void 0:t.length)!=null?d:0)>0},Z2=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!k.entityKey},xP=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!k.entityKey},wn=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!k.entityKey},LGG=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!k.entityKey},
TX=function(k,n,t,d,G){G=G===void 0?!1:G;
var R,O,D,Z,x,w;return g.H(function(T){if(T.B==1)return R=g.S5(k,n),O=g.S5(k,"downloadStatusEntity"),g.q(T,Ce(t,{mode:"readonly",PC:!0},function(J){return g.Bh.all([zi(J,R,n),zi(J,O,"downloadStatusEntity")])}),2);
D=T.T;Z=D.length?D[0]:void 0;if(!Z)return T.DH(0);x=bS_;if(w=D.length>1?D[1]:void 0){if(w.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!G)return T.return();w.downloadState=d}else w={key:O,downloadState:d};g.am(Z,x,w);return g.q(T,Ce(t,{mode:"readwrite",PC:!0},function(J){return g.Bh.all([vD(J,Z,n),vD(J,w,"downloadStatusEntity")])}),0)})},iw=function(k,n){return k.actionType===n.actionType&&k.entityKey===n.entityKey},JO=function(k,n){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!==
"TRANSFER_STATE_FAILED"){var t=g.pC(k.key).entityId;
D2({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:t,TP:k,offlineModeType:n})}},L3=function(k){if(!k||!k.thumbnails)return[];
var n=[];k=g.y(k.thumbnails);for(var t=k.next();!t.done;t=k.next())t=t.value,t.url&&n.push(t.url);return n},mw4=function(k,n,t){t=t===void 0?[]:t;
var d,G,R,O,D,Z,x,w,T,J,L,b,E;return g.H(function(B){if(B.B==1)return t.length?g.q(B,Sg(k,n),2):B.return([]);d=B.T;G=new Set;R=g.y(d);for(O=R.next();!O.done;O=R.next())if(D=O.value,Z=D.id||D.key)x=g.pC(Z).entityId,G.add(x);w=[];T=g.y(t);for(J=T.next();!J.done;J=T.next())L=J.value,b=L.offlineVideoData,E=void 0,((E=b)==null?0:E.videoId)&&!G.has(b.videoId)&&w.push(L);return B.return(w)})},yBD=function(k,n,t){return new g.Mo(k,{cotn:n,
raw_player_response:t,download_media:!0,start:Infinity,disable_watch_next:!0})},s84=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},bw=function(k,n,t,d,G,R,O,D,Z,x,w){this.entityType=k;
this.actionId=n;this.action=t;this.parentActionId=d;this.rootActionId=G===void 0?n:G;this.childActionIds=R;this.prereqActionId=O;this.postreqActionIds=D;this.hasChildActionFailed=x;this.retryScheduleIndex=0;this.B=w||Date.now();this.retryScheduleIndex=Z||0},mN=function(k){if(!k.key)throw Error("Entity key is required.");
if(!k.actionProto)throw Error("OfflineOrchestrationAction is required.");var n=g.pC(k.key),t=g.pC(k.actionProto.entityKey);return new bw(t.entityType,n.entityId,k.actionProto,k.parentActionId,k.rootActionId,k.childActionIds,k.prereqActionId,k.postreqActionIds,k.retryScheduleIndex,k.hasChildActionFailed,Number(k.enqueueTimeSec)*1E3)},y2=function(k){return{key:g.S5(k.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:k.action,parentActionId:k.parentActionId,rootActionId:k.rootActionId,childActionIds:k.childActionIds,prereqActionId:k.prereqActionId,postreqActionIds:k.postreqActionIds,retryScheduleIndex:k.retryScheduleIndex,hasChildActionFailed:k.hasChildActionFailed,enqueueTimeSec:(k.B/1E3).toFixed()}},Xjf=function(){var k;
return g.H(function(n){return n.B==1?g.q(n,YGC(),2):(k=n.T)?n.return(k.delete("yt-player-local-img")):n.return(!0)})},sF=function(k){var n,t;
return g.H(function(d){if(d.B==1)return g.q(d,YGC(),2);if(d.B!=3){n=d.T;if(!n)throw Error("Cache API not supported");return k.length?g.q(d,n.open("yt-player-local-img"),3):d.return()}t=d.T;return g.q(d,Promise.all(k.map(function(G){return t.delete(G)})),0)})},XZ=function(k){var n,t;
return g.H(function(d){if(d.B==1)return g.q(d,YGC(),2);if(d.B!=3){n=d.T;if(!n)throw Error("Cache API not supported");return k.length?g.q(d,n.open("yt-player-local-img"),3):d.return()}t=d.T;return g.q(d,t.addAll(k),0)})},EF=function(k,n,t,d,G){var R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk;
return g.H(function(DG){switch(DG.B){case 1:return R=g.S5(k,"mainVideoEntity"),O=g.S5(k,"ytMainChannelEntity"),D=g.S5(k,"transfer"),Z=g.S5(k,"videoDownloadContextEntity"),g.q(DG,Ce(n,{mode:"readonly",PC:!0},function(yD){return g.Bh.all([zi(yD,R,"mainVideoEntity"),zi(yD,O,"ytMainChannelEntity"),zi(yD,D,"transfer"),zi(yD,Z,"videoDownloadContextEntity"),aZ(yD,"ytMainChannelEntity"),aZ(yD,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:x=DG.T;w=g.y(x);T=w.next().value;J=w.next().value;L=w.next().value;b=w.next().value;E=w.next().value;B=w.next().value;h=T;W=J;e=L;P=b;Q=E;k$=B;if(!h&&!W){DG.DH(3);break}M=h?L3(h.thumbnail):[];if(!W){Gb=[];DG.DH(4);break}return g.q(DG,EsW(W,Q),5);case 5:Gb=DG.T;case 4:return Y$=Gb,g.q(DG,sF(M.concat(Y$)),3);case 3:S=[];a=g.S5(k,"downloadStatusEntity");p=g.y(k$);for(X=p.next();!X.done;X=p.next())K=X.value,zb=g.pC(K.key).entityId,hk=mN(K),m_=g.pC(hk.action.entityKey).entityId,zb!==k&&m_!==k||
iw(t,K.actionProto)||S.push(K.key);return g.q(DG,Ce(n,{mode:"readwrite",PC:!0},function(yD){var I=S.map(function(V){return uJ(yD,V)});
I.push(uJ(yD,R,{Xk:!0}));I.push(uJ(yD,a,{Xk:!0}));return g.Bh.all(I)}),7);
case 7:tk=(Vq=P)==null?void 0:Vq.offlineModeType,G&&(o4(G),G.offlineModeType&&(tk=G.offlineModeType)),JO(e,tk),OF(d,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yq(DG)}})},IxC=function(k,n,t,d){var G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk,DG,yD,I,V,A,F,r,nw,RJ,Ot,c,Et,oJ,D7,PI,pw,zm,ke;
return g.H(function(MI){switch(MI.B){case 1:return G=g.S5(k,"mainPlaylistEntity"),R=g.S5(k,"ytMainChannelEntity"),g.q(MI,Ce(n,{mode:"readonly",PC:!0},function(Cl){return g.Bh.all([zi(Cl,G,"mainPlaylistEntity"),zi(Cl,R,"ytMainChannelEntity"),aZ(Cl,"mainPlaylistEntity"),aZ(Cl,"mainDownloadsListEntity"),aZ(Cl,"ytMainChannelEntity"),aZ(Cl,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=MI.T;D=g.y(O);Z=D.next().value;x=D.next().value;w=D.next().value;T=D.next().value;J=D.next().value;L=D.next().value;b=Z;E=x;B=w;h=T;W=J;e=L;if(!b&&!E){MI.DH(3);break}P=b?Uwm(b):[];if(!E){Q=[];MI.DH(4);break}return g.q(MI,EsW(E,W),5);case 5:Q=MI.T;case 4:return k$=Q,g.q(MI,sF(P.concat(k$)),3);case 3:M=[];Gb=new Map;if(!b){MI.DH(7);break}return g.q(MI,BsO(b,B,h),8);case 8:M=MI.T;Y$=g.y(M);for(S=Y$.next();!S.done;S=Y$.next())a=S.value,Gb.set(a,{videoId:a,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.q(MI,Ce(n,{mode:"readonly",PC:!0},function(Cl){return g.Bh.all([aZ(Cl,"transfer"),aZ(Cl,"videoDownloadContextEntity")])}),9);
case 9:p=MI.T;X=g.y(p);K=X.next().value;zb=X.next().value;hk=K;m_=zb;Vq=g.y(hk);for(tk=Vq.next();!tk.done;tk=Vq.next())DG=tk.value,yD=g.pC(DG.key).entityId,(I=Gb.get(yD))&&DG&&(I.cotn=DG.cotn);V=g.y(m_);for(A=V.next();!A.done;A=V.next())F=A.value,r=g.pC(F.key).entityId,(nw=Gb.get(r))&&F&&(nw.offlineModeType=F.offlineModeType);case 7:RJ=[];Ot=g.y(e);for(c=Ot.next();!c.done;c=Ot.next())Et=c.value,oJ=g.pC(Et.key).entityId,D7=mN(Et),oJ!==k&&D7.rootActionId!==k||iw(t,Et.actionProto)||RJ.push(Et.key);PI=
g.S5(k,"mainPlaylistEntity");return g.q(MI,Ce(n,{mode:"readwrite",PC:!0},function(Cl){var zP=RJ.map(function(bl){return uJ(Cl,bl)});
zP.push(uJ(Cl,PI,{Xk:!0}));return g.Bh.all(zP)}),10);
case 10:if(!b){MI.DH(0);break}M.reverse();if(!M){MI.DH(0);break}pw=g.y(M);zm=pw.next();case 13:if(zm.done){MI.DH(0);break}ke=zm.value;return g.q(MI,EF(ke,n,t,d,Gb.get(ke)),14);case 14:zm=pw.next(),MI.DH(13)}})},VyK=function(k,n,t,d){var G,R,O,D,Z,x,w,T,J;
return g.H(function(L){if(L.B==1)return G=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),R=new Map,g.q(L,Ce(k,{mode:"readwrite",PC:!0},function(b){var E=aZ(b,"transfer"),B=aZ(b,"offlineOrchestrationActionWrapperEntity"),h=aZ(b,"videoDownloadContextEntity"),W=zi(b,G,"mainDownloadsListEntity");return g.Bh.all([E,B,h,W]).then(function(e){e=g.y(e);var P=e.next().value;var Q=e.next().value;var k$=e.next().value;var M=e.next().value;e=h2_.map(function(Y$){return UG5(b,Y$)});
Q=g.y(Q);for(var Gb=Q.next();!Gb.done;Gb=Q.next())Gb=Gb.value,iw(n,Gb.actionProto)||e.push(uJ(b,Gb.key,{Xk:!0}));M&&(M.downloads=[],e.push(vD(b,M,"mainDownloadsListEntity")));if(k$)for(k$=g.y(k$),M=k$.next();!M.done;M=k$.next())M=M.value,Q=g.pC(M.key).entityId,Q=g.S5(Q,"transfer"),R.set(Q,M.offlineModeType);return g.Bh.all(e).then(function(){return P})})}),2);
O=L.T;D=g.y(O);for(Z=D.next();!Z.done;Z=D.next())x=Z.value,JO(x,R.get(x.key)),w=g.pC(x.key).entityId,T={videoId:w,offlineDeleteReason:d,cotn:x.cotn,offlineModeType:R.get(x.key)},o4(T),J=g.S5(w,"mainVideoEntity"),OF(t,{entityKey:J,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.q(L,Xjf(),0)})},Uwm=function(k,n){var t=[];
if(k.thumbnailStyleData){k=g.y(k.thumbnailStyleData);for(var d=k.next();!d.done;d=k.next()){var G=void 0,R=void 0,O=void 0;t=t.concat(L3((G=d.value)==null?void 0:(R=G.value)==null?void 0:(O=R.collageThumbnail)==null?void 0:O.coverThumbnail))}}n=L3(n);return t.concat(n)},BsO=function(k,n,t){var d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$;
return g.H(function(S){d=[];G=new Set;if(t.length)for(R=g.y(t),O=R.next();!O.done;O=R.next())if(D=O.value,Z=void 0,(Z=D.downloads)==null?0:Z.length)for(x=g.y(D.downloads),w=x.next();!w.done;w=x.next())T=w.value,T.videoItem&&(J=g.pC(T.videoItem).entityId,G.add(J));if(k.videos){L=g.y(k.videos);for(b=L.next();!b.done;b=L.next())E=b.value,B=JSON.parse(g.pC(E).entityId),B.videoId&&!G.has(B.videoId)&&d.push(B.videoId);h=g.y(n);for(W=h.next();!W.done;W=h.next())if(e=W.value,e.key!==k.key&&(P=e.videos))for(Q=
g.y(P),k$=Q.next();!k$.done;k$=Q.next())M=k$.value,Gb=JSON.parse(g.pC(M).entityId),Gb.videoId&&(Y$=d.indexOf(Gb.videoId),Y$!==-1&&d.splice(Y$,1))}return S.return(d)})},EsW=function(k,n){var t,d,G,R,O,D,Z,x;
return g.H(function(w){t=L3(k.avatar);d=g.y(n);for(G=d.next();!G.done;G=d.next())if(R=G.value,R.id!==k.id)for(O=g.y(L3(R.avatar)),D=O.next();!D.done;D=O.next())Z=D.value,x=t.indexOf(Z),x!==-1&&t.splice(x,1);return w.return(t)})},ABm=function(k){var n;
return g.H(function(t){n=g.z(k.frameworkUpdates,UF);return k.frameworkUpdates&&n?g.q(t,rHk(n),0):t.return()})},qGK=function(k){var n;
if((n=k.onResponseReceivedActions)!=null&&n.length){var t;k=(t=g.z(g.z(k.onResponseReceivedActions[0],WGk),g.z$_))==null?void 0:t.actions;if(k!=null&&k.length)return k}},e2f=function(k){var n,t,d;
return g.H(function(G){if(G.B==1)return k?g.q(G,pe(k,g.HX,"mainDownloadsListEntity"),2):G.return([]);n=G.T;return((t=n)==null?0:(d=t.downloads)==null?0:d.length)?G.return(n.downloads.map(function(R){var O;return(O=R.videoItem)!=null?O:""})):G.return([])})},FGf=function(k,n){var t;
return g.H(function(d){return d.B==1?g.q(d,HS5(k,n),2):(t=d.T)?g.q(d,Ce(k,{mode:"readwrite",PC:!0},function(G){var R=[vD(G,t.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];t.mainDownloadsListEntity&&R.push(vD(G,t.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Bh.all(R)}),0):d.DH(0)})},HS5=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e;
return g.H(function(P){if(P.B==1)return t=g.S5("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.q(P,Ce(k,{mode:"readonly",PC:!0},function(Q){return g.Bh.all([zi(Q,t,"mainDownloadsLibraryEntity"),zi(Q,d,"mainDownloadsListEntity")])}),2);
G=P.T;R=g.y(G);O=R.next().value;D=R.next().value;Z=O;x=D;Z||(Z={id:t});w=g.y(n);for(T=w.next();!T.done;T=w.next())if(J=T.value,J===g.HX){if(Z.smartDownloadsList)return P.return();Z.smartDownloadsList=J}else if(L=g.pC(J).entityType,b={},L==="mainPlaylistEntity"?b.playlistItem=J:L==="mainVideoEntity"&&(b.videoItem=J),!g.je(b)){E=void 0;if((E=x)==null?0:E.downloads){B=!1;h=g.y(x.downloads);for(W=h.next();!W.done;W=h.next())if(e=W.value,e.playlistItem===J||e.videoItem===J){B=!0;break}B||x.downloads.push(b)}else x=
{id:d,downloads:[b]};Z.downloadsList=d}return P.return({mainDownloadsLibraryEntity:Z,mainDownloadsListEntity:x})})},PL4=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B;
return g.H(function(h){if(h.B==1)return t=g.S5("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.q(h,Ce(k,{mode:"readonly",PC:!0},function(W){return g.Bh.all([zi(W,t,"mainDownloadsLibraryEntity"),zi(W,d,"mainDownloadsListEntity"),zi(W,g.HX,"mainDownloadsListEntity")])}),2);
G=h.T;R=g.y(G);O=R.next().value;D=R.next().value;Z=R.next().value;x=O;w=D;T=Z;if(!x)return h.DH(0);if(n===g.HX&&((J=T)==null?0:J.downloads))T.downloads=[];else if((L=w)==null?0:L.downloads)for(b=g.pC(n).entityType,E=0;E<w.downloads.length;E++)if(B=w.downloads[E],b==="mainVideoEntity"&&B.videoItem===n){w.downloads.splice(E,1);break}else if(b==="mainPlaylistEntity"&&B.playlistItem===n){w.downloads.splice(E,1);break}return g.q(h,Ce(k,{mode:"readwrite",PC:!0},function(W){var e=[vD(W,x,"mainDownloadsLibraryEntity")];
w&&e.push(vD(W,w,"mainDownloadsListEntity"));T&&e.push(vD(W,T,"mainDownloadsListEntity"));return g.Bh.all(e)}),0)})},B6=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J;
return g.H(function(L){if(L.B==1)return t=g.S5(n,"transfer"),d=g.S5(n,"videoDownloadContextEntity"),g.q(L,Ce(k,{mode:"readonly",PC:!0},function(b){return g.Bh.all([zi(b,t,"transfer"),zi(b,d,"videoDownloadContextEntity")])}),2);
G=L.T;R=g.y(G);O=R.next().value;D=R.next().value;Z=O;x=D;J={videoId:n,cotn:(w=Z)==null?void 0:w.cotn,offlineModeType:(T=x)==null?void 0:T.offlineModeType};return L.return(J)})},I4=function(k,n,t,d,G){var R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb;
return g.H(function(Y$){switch(Y$.B){case 1:return R=g.S5(k,"musicTrack"),O=g.S5(k,"transfer"),g.q(Y$,Ce(n,{mode:"readonly",PC:!0},function(S){return g.Bh.all([zi(S,R,"musicTrack"),zi(S,O,"transfer"),aZ(S,"musicTrack"),aZ(S,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=Y$.T;Z=g.y(D);x=Z.next().value;w=Z.next().value;T=Z.next().value;J=Z.next().value;L=x;b=w;E=T;B=J;if(!L){Y$.DH(3);break}return g.q(Y$,j8C(L,E),4);case 4:return h=Y$.T,g.q(Y$,sF(h),3);case 3:W=[];e=g.y(B);for(P=e.next();!P.done;P=e.next())Q=P.value,k$=g.pC(Q.key).entityId,M=mN(Q),Gb=g.pC(M.action.entityKey).entityId,k$!==k&&Gb!==k||iw(t,Q.actionProto)||W.push(Q.key);return g.q(Y$,Ce(n,{mode:"readwrite",PC:!0},function(S){var a=W.map(function(p){return uJ(S,p)});
a.push(uJ(S,R,{Xk:!0}));return g.Bh.all(a)}),6);
case 6:JO(b),G&&o4(G),OF(d,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yq(Y$)}})},hO=function(k,n,t,d,G){var R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk,DG,yD,I,V,A;
return g.H(function(F){switch(F.B){case 1:return R=g.S5(k,n),O=g.S5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(F,Ce(t,{mode:"readonly",PC:!0},function(r){return g.Bh.all([zi(r,R,n),zi(r,O,"musicDownloadsLibraryEntity"),aZ(r,n),aZ(r,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=F.T;Z=g.y(D);x=Z.next().value;w=Z.next().value;T=Z.next().value;J=Z.next().value;L=x;b=w;E=T;B=J;if(!L){F.DH(3);break}return g.q(F,j8C(L,E),4);case 4:return h=F.T,g.q(F,sF(h),3);case 3:W=[];e=new Map;if(!L){F.DH(6);break}return g.q(F,rB4(L,E,b),7);case 7:W=F.T;P=g.y(W);for(Q=P.next();!Q.done;Q=P.next())k$=Q.value,M=g.pC(k$).entityId,e.set(M,{videoId:M,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.q(F,Sg(t,"transfer"),8);case 8:for(Gb=F.T,Y$=g.y(Gb),
S=Y$.next();!S.done;S=Y$.next())a=S.value,p=g.pC(a.key).entityId,(X=e.get(p))&&a&&(X.cotn=a.cotn);case 6:K=[];zb=g.y(B);for(hk=zb.next();!hk.done;hk=zb.next())m_=hk.value,Vq=g.pC(m_.key).entityId,tk=mN(m_),Vq!==k&&tk.rootActionId!==k||iw(d,m_.actionProto)||K.push(m_.key);DG=g.S5(k,n);return g.q(F,Ce(t,{mode:"readwrite",PC:!0},function(r){var nw=K.map(function(RJ){return uJ(r,RJ)});
nw.push(uJ(r,DG,{Xk:!0}));return g.Bh.all(nw)}),9);
case 9:if(!L){F.DH(0);break}W.reverse();if(!W.length){F.DH(0);break}yD=g.y(W);I=yD.next();case 12:if(I.done){F.DH(0);break}V=I.value;A=g.pC(V).entityId;if(!A){F.DH(13);break}return g.q(F,I4(A,t,d,G,e.get(A)),13);case 13:I=yD.next(),F.DH(12)}})},V2=function(k,n,t){var d,G,R,O,D,Z,x;
return g.H(function(w){if(w.B==1)return g.q(w,Ce(k,{mode:"readwrite",PC:!0},function(T){var J=aZ(T,"transfer"),L=aZ(T,"offlineOrchestrationActionWrapperEntity");return g.Bh.all([J,L]).then(function(b){b=g.y(b);var E=b.next().value;var B=b.next().value;b=cB7.map(function(P){return UG5(T,P)});
B=g.y(B);for(var h=B.next();!h.done;h=B.next()){h=h.value;var W=g.pC(h.actionProto.entityKey).entityType==="musicTrack",e=h.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";iw(n,h.actionProto)||W&&(!W||e)||b.push(uJ(T,h.key,{Xk:!0}))}return g.Bh.all(b).then(function(){return E})})}),2);
d=w.T;G=g.y(d);for(R=G.next();!R.done;R=G.next())O=R.value,JO(O),D=g.pC(O.key).entityId,Z={videoId:D,offlineDeleteReason:void 0,cotn:O.cotn},o4(Z),x=g.S5(D,"musicTrack"),OF(t,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.q(w,Xjf(),0)})},Nsm=function(k){for(var n,t=g.y(k.additionalMetadatas),d=t.next();!d.done;d=t.next())d=d.value,d.offlineMusicVideoData&&(n=d.offlineMusicVideoData);
var G,R,O,D,Z;return{id:g.S5(k.videoId,"musicTrack"),videoId:k.videoId,title:k.title,thumbnailDetails:k.thumbnail,lengthMs:String(Number(k.lengthSeconds)*1E3),albumTitle:(G=n)==null?void 0:G.releaseTitle,musicVideoType:(R=n)==null?void 0:R.musicVideoType,contentRating:{explicitType:(O=n)==null?void 0:O.explicitType},artistNames:((D=n)==null?void 0:D.byline)||((Z=n)==null?void 0:Z.channelName),downloadMetadata:g.S5(k.videoId,"musicTrackDownloadMetadataEntity")}},rB4=function(k,n,t){var d,G,R,O,D,Z,
x,w,T,J,L,b,E,B,h,W,e,P;
return g.H(function(Q){d=[];G=new Set;if((R=t)==null?0:(O=R.downloadedTracks)==null?0:O.length)for(D=g.y(t.downloadedTracks),Z=D.next();!Z.done;Z=D.next())x=Z.value,G.add(x);if(k.tracks){w=g.y(k.tracks);for(T=w.next();!T.done;T=w.next())J=T.value,G.has(J)||d.push(J);L=g.y(n);for(b=L.next();!b.done;b=L.next())if(E=b.value,E.id!==k.id&&(B=E.tracks))for(h=g.y(B),W=h.next();!W.done;W=h.next())e=W.value,P=d.indexOf(e),P!==-1&&d.splice(P,1)}return Q.return(d)})},j8C=function(k,n){var t,d,G,R,O,D,Z,x;
return g.H(function(w){t=L3(k.thumbnailDetails);d=g.y(n);for(G=d.next();!G.done;G=d.next())if(R=G.value,R.id!==k.id)for(O=g.y(L3(R.thumbnailDetails)),D=O.next();!D.done;D=O.next())Z=D.value,x=t.indexOf(Z),x!==-1&&t.splice(x,1);return w.return(t)})},fxi=function(k,n){var t,d,G,R,O,D,Z,x,w;
return g.H(function(T){if(T.B==1)return t=g.S5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(T,pe(k,t,"musicDownloadsLibraryEntity"),2);(d=T.T)||(d={id:t});G=g.pC(n).entityType;G==="musicTrack"?(R=d.downloadedTracks)!=null&&R.includes(n)||(d.downloadedTracks=((O=d.downloadedTracks)!=null?O:[]).concat(n)):G==="musicPlaylist"?(D=d.downloadedPlaylists)!=null&&D.includes(n)||(d.downloadedPlaylists=((Z=d.downloadedPlaylists)!=null?Z:[]).concat(n)):G!=="musicAlbumRelease"||(x=d.downloadedAlbumReleases)!=
null&&x.includes(n)||(d.downloadedAlbumReleases=((w=d.downloadedAlbumReleases)!=null?w:[]).concat(n));return g.q(T,lJ(k,d,"musicDownloadsLibraryEntity"),0)})},Q8f=function(k,n){var t,d,G,R,O,D,Z;
return g.H(function(x){if(x.B==1)return t=g.S5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(x,pe(k,t,"musicDownloadsLibraryEntity"),2);d=x.T;if(!d)return x.DH(0);G=g.pC(n).entityType;G==="musicTrack"?R=d.downloadedTracks:G==="musicPlaylist"&&(R=d.downloadedPlaylists);if((O=R)==null?0:O.length)for(D=0;D<R.length;D++)if(Z=R[D],Z===n){R.splice(D,1);break}return g.q(x,lJ(k,d,"musicDownloadsLibraryEntity"),0)})},z25=function(k){var n=k.videos;
k=[];var t=[];if(n){n=g.y(n);for(var d=n.next();!d.done;d=n.next()){var G=d.value.offlineVideoData.videoId;d=g.S5(G,"musicTrack");G=g.S5(G,"musicTrackDownloadMetadataEntity");k.push(d);t.push(G)}}return{Sn:k,rR:t}},AO=function(k,n,t){n={track:Nsm(n)};
t&&(n.playlistId=t);if(k=g.z(k.actionMetadata,axD))n.maximumDownloadQuality=k.maximumDownloadQuality;return{musicTrackEntityActionMetadata:n}},vsD=function(k){var n,t,d,G,R,O,D,Z;
return g.H(function(x){switch(x.B){case 1:return n=g.YB(),t=vzf(k),d=g.t9(KGO),g.Xh(x,2),R={xA:!0},g.q(x,g.CH(n,t,d,void 0,R),4);case 4:G=x.T;g.BI(x,3);break;case 2:O=g.IJ(x);if(O instanceof g.GO)throw D="GetOffline network manager error: "+O.message,GX(D,O),Error(D);GX("GetOffline fetch request error",O);throw Error("GetOffline fetch request error");case 3:Z=W6(G);if(!G)throw GX("Network request failed"),Error("Network request failed");if(Z!==void 0)qa(Z);else if(!G.videos||!G.videos.length)throw GX("No data"),
Error("No data");return x.return(G.videos.map(function(w){return w.offlineVideoData}))}})},uJ4=function(k){var n,t,d,G,R,O,D,Z;
return g.H(function(x){switch(x.B){case 1:return n=g.YB(),t=uf5(k),d=g.t9(KGO),g.Xh(x,2),R={xA:!0},g.q(x,g.CH(n,t,d,void 0,R),4);case 4:G=x.T;g.BI(x,3);break;case 2:O=g.IJ(x);if(O instanceof g.GO)throw D="GetOffline network manager error for playlist: "+O.message,GX(D,O),Error(D);GX("GetOffline fetch request error for playlist",O);throw Error("GetOffline fetch request error for playlist");case 3:Z=W6(G);if(!G)throw GX("Network request failed for playlist"),Error("Network request failed for playlist");
if(Z!==void 0)qa(Z,"playlist");else if(!G.playlists||!G.playlists.length)throw GX("No data for playlist"),Error("No data for playlist");return x.return(G.playlists.map(function(w){return w.offlinePlaylistData}))}})},gs_=function(k,n,t,d){var G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_;
return g.H(function(Vq){switch(Vq.B){case 1:return g.q(Vq,kP(),2);case 2:G=Vq.T;if(!G)return Vq.return([]);R=[];if((O=d)==null?0:O.length){R=d;Vq.DH(3);break}return g.q(Vq,Sg(G,"mainPlaylistEntity"),4);case 4:R=Vq.T;case 3:if(!R.length)return Vq.return([]);D=[];Z=Date.now()/1E3;x=g.y(R);w=x.next();case 5:if(w.done)return D.length?g.q(Vq,Myf(D),10):Vq.return([]);T=w.value;if(!T.downloadState){J=void 0;Vq.DH(8);break}return g.q(Vq,pe(G,T.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:J=
Vq.T;case 8:L=J;b=void 0;B=(E=(b=T)==null?void 0:b.entityMetadata)&&E.nextAutoRefreshIntervalSeconds?Number(E.nextAutoRefreshIntervalSeconds):NaN;h=Number.isNaN(B)?k:B;e=W=void 0;P=((W=L)==null?0:W.lastSyncedTimestampMillis)?Number((e=L)==null?void 0:e.lastSyncedTimestampMillis)/1E3:0;k$=Q=void 0;M=((Q=L)==null?0:Q.addedTimestampMillis)?Number((k$=L)==null?void 0:k$.addedTimestampMillis)/1E3:0;if(t||!E||P+h<=Z){Gb=[];Y$=void 0;if((Y$=T.videos)==null?0:Y$.length)for(S=g.y(T.videos),a=S.next();!a.done;a=
S.next())p=a.value,X=JSON.parse(g.pC(p).entityId),X.videoId&&Gb.push(X.videoId);K="0";E&&(zb=void 0,K=String(Number((zb=E.offlineLastModifiedTimestampSeconds)!=null?zb:0).toFixed()));hk={playlistId:T.playlistId,videoIds:Gb,offlineLastModifiedTimestamp:K,autoSync:n,offlineDateAddedTimestamp:String(M.toFixed())};D.push(hk)}w=x.next();Vq.DH(5);break;case 10:return m_=Vq.T,Vq.return(m_)}})},CL7=function(){var k,n,t,d,G;
return g.H(function(R){if(R.B==1)return g.q(R,kP(),2);if(R.B!=3)return(k=R.T)?g.q(R,Sg(k,"refresh"),3):R.return(!1);n=R.T;if((t=n[0])==null||!t.refreshTime)return R.return(!1);d=Number(n[0].refreshTime);G=Date.now()/1E3;return R.return(isFinite(d)&&G>=d)})},pjW=function(k,n){var t,d,G;
return g.H(function(R){switch(R.B){case 1:return g.Xh(R,2),g.q(R,lxD(k,n),4);case 4:return d=R.T,g.q(R,ABm(d),5);case 5:t=qGK(d);g.BI(R,3);break;case 2:G=g.IJ(R),GX("getAndProcessSmartDownloadsResponse request or processing error",G);case 3:return R.return(t)}})},SGG=function(k,n,t,d){var G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_;
return g.H(function(Vq){switch(Vq.B){case 1:return g.q(Vq,kP(),2);case 2:G=Vq.T;if(!G)return Vq.return([]);R=[];if((O=d)==null?0:O.length){R=d;Vq.DH(3);break}return g.q(Vq,Sg(G,"musicPlaylist"),4);case 4:R=Vq.T;case 3:if(!R.length)return Vq.return([]);D=[];Z=Date.now()/1E3;x=g.y(R);w=x.next();case 5:if(w.done)return D.length?g.q(Vq,Myf(D),10):Vq.return([]);T=w.value;J=void 0;b=(L=(J=T)==null?void 0:J.entityMetadata)&&L.nextAutoRefreshIntervalSeconds?Number(L.nextAutoRefreshIntervalSeconds):NaN;E=
Number.isNaN(b)?k:b;h=B=0;W="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!T.downloadMetadata){Vq.DH(8);break}return g.q(Vq,pe(G,T.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:e=Vq.T,Q=P=void 0,B=Number((Q=(P=e)==null?void 0:P.addedTimestampMillis)!=null?Q:"0")/1E3,M=k$=void 0,h=Number((M=(k$=e)==null?void 0:k$.lastModifiedTimestampMillis)!=null?M:"0")/1E3,Y$=Gb=void 0,W=(Y$=(Gb=e)==null?void 0:Gb.syncState)!=null?Y$:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:S=void 0;if(t||W!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!L||Number((S=L.lastSyncedTimestampSeconds)!=null?S:0)+E<=Z){a=[];p=void 0;if((p=T.tracks)==null?0:p.length)for(X=g.y(T.tracks),K=X.next();!K.done;K=X.next())zb=K.value,a.push(g.pC(zb).entityId);hk={playlistId:T.playlistId,videoIds:a,offlineLastModifiedTimestamp:String(h.toFixed()),autoSync:n,offlineDateAddedTimestamp:String(B.toFixed())};D.push(hk)}w=x.next();Vq.DH(5);break;case 10:return m_=Vq.T,Vq.return(m_)}})},lxD=function(k,n){var t,d,G,R,O,D,Z,x,w,T;
return g.H(function(J){switch(J.B){case 1:return t=g.YB(),g.q(J,kP(),2);case 2:d=J.T;if(!d){J.DH(3);break}return g.q(J,kgm(d),4);case 4:G=J.T;case 3:var L=G;R={context:g.S1(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:k},offlineClientState:L,clientStateRequestData:{preferredFormatType:n}}}};O=g.t9(ktK);g.Xh(J,5);Z={xA:!0};return g.q(J,g.CH(t,R,O,void 0,Z),7);case 7:D=J.T;g.BI(J,6);break;case 5:x=g.IJ(J);if(x instanceof g.GO)throw w=
"DPS network manager error for smart downloads: "+x.message,GX(w,x),Error(w);GX("DPS fetch request error for smart downloads",x);throw Error("DPS fetch request error for smart downloads");case 6:T=W6(D);if(D)T!==void 0&&qa(T,"smart downloads");else throw GX("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return J.return(D)}})},t45=function(k,n){var t,d,G,R,O,D,Z,x;
return g.H(function(w){switch(w.B){case 1:return t=g.YB(),d={context:g.S1(),videoPlaybackPositionEntities:k,lastSyncTimestampUsec:n},G=g.t9(n1W),g.Xh(w,2),O={xA:!0},g.q(w,g.CH(t,d,G,void 0,O),4);case 4:R=w.T;g.BI(w,3);break;case 2:D=g.IJ(w);if(D instanceof g.GO)throw Z="VPPS network manager error: "+D.message,GX(Z,D),Error(Z);GX("VPPS fetch request error",D);throw Error("VPPS fetch request error");case 3:x=W6(R);if(R)x!==void 0&&qa(x,"position sync");else throw GX("Network request failed for position sync"),
Error("Network request failed for position sync");return w.return(R)}})},Gt7=function(k,n,t){var d,G,R,O,D,Z,x,w;
return g.H(function(T){switch(T.B){case 1:d=g.YB();var J=t.refreshData,L=t.isEnqueuedForExpiredStreamUrlRefetch,b=t.v4,E=t.offlineSourceData,B=t.mediaCapabilities,h={entityKey:k};J&&(h.refreshData=J);L&&(h.isExpiredStreamUrlRefetch=L);b&&(h.downloadParameters=b);E&&(h.offlineSourceData=E);J={context:g.xH(n),signatureTimestamp:20173,videos:[h]};B&&(J.mediaCapabilities=B);G=J;R=g.t9(dfC);g.Xh(T,2);D={xA:!0};return g.q(T,g.CH(d,G,R,void 0,D),4);case 4:O=T.T;g.BI(T,3);break;case 2:Z=g.IJ(T);if(Z instanceof
g.GO)throw x="GetPDE network manager error: "+Z.message,GX(x,Z),Error(x);GX("GetPDE fetch request error",Z);throw Error("GetPDE fetch request error");case 3:w=W6(O);if(O)w!==void 0&&qa(w,"PDE");else throw GX("Network request failed for PDE"),Error("Network request failed for PDE");return T.return(O)}})},W6=function(k){var n;
return(n=k.errorMetadata)==null?void 0:n.status},qa=function(k,n){n=n?" for "+n:"";
if(k===0)throw k="Empty response body"+n,GX(k),Error(k);k="Response with error"+n;GX(k);throw Error(k);},Myf=function(k){var n,t,d,G,R,O,D,Z;
return g.H(function(x){switch(x.B){case 1:return n=g.YB(),t=M$W(k),d=g.t9(RiK),g.Xh(x,2),R={xA:!0},g.q(x,g.CH(n,t,d,void 0,R),4);case 4:G=x.T;g.BI(x,3);break;case 2:O=g.IJ(x);if(O instanceof g.GO)throw D="offlinePlaylistSyncCheck network manager error: "+O.message,GX(D,O),Error(D);GX("offlinePlaylistSyncCheck fetch request error",O);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:Z=W6(G);if(!G)throw GX("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(Z!==void 0)qa(Z,"playlist sync");else if(!G.offlinePlaylistSyncCheckDatas||!G.offlinePlaylistSyncCheckDatas.length)throw GX("No data for playlist sync"),Error("No data for playlist sync");return x.return(G.offlinePlaylistSyncCheckDatas.map(function(w){return w.offlinePlaylistSyncCheckData}))}})},er=function(k){this.B=k},OB5=function(k,n){var t,d,G,R,O,D;
return g.H(function(Z){switch(Z.B){case 1:t=new Map,d=g.y(n),G=d.next();case 2:if(G.done){Z.DH(4);break}R=G.value;O=t;D=O.set;return g.q(Z,k.T(R),5);case 5:D.call(O,R,Z.T);G=d.next();Z.DH(2);break;case 4:return Z.return(t)}})},H6=function(k,n,t,d,G,R){n=g.S5(n,t);
d=Object.assign({},R,{priority:d,retryScheduleIntervalsInSeconds:G});return{actionType:k,entityKey:n,actionMetadata:d}},FZ=function(k,n,t,d,G,R){this.status=k;
this.B=n;this.S=t;this.T=d;this.C=G;this.downloadState=R},YSm=function(k,n,t){this.B=k;
this.q3=n;this.C=t},$fk=function(k,n){var t,d,G,R,O,D,Z,x,w;
return g.H(function(T){switch(T.B){case 1:return t=n.entityKey,G=(d=g.z(n.actionMetadata,P6))==null?void 0:d.isEnqueuedForExpiredStreamUrlRefetch,g.Xh(T,2),R=void 0,g.q(T,o1D(k,n),4);case 4:R=T.T;g.Xh(T,5);var J=(J=g.z(n.actionMetadata,P6))?{maximumDownloadQuality:J.maximumDownloadQuality}:void 0;return g.q(T,Gt7(t,k.q3,{isEnqueuedForExpiredStreamUrlRefetch:G,v4:J,offlineSourceData:R}),7);case 7:O=T.T;g.BI(T,6,2);break;case 5:return g.IJ(T,2),D=$P(n)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",GX("PDE handleAdd error"),T.return(jr(n,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,"DOWNLOAD_STATE_FAILED"));case 6:return g.q(T,Df_(k,O,n),8);case 8:return T.return(jr(n,!0,O.orchestrationActions));case 2:return Z=g.IJ(T),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.b4&&Z.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),GX("PDE handleAdd error"),T.return(jr(n,!1,void 0,x,w,"DOWNLOAD_STATE_FAILED"))}})},w_5=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$;
return g.H(function(S){switch(S.B){case 1:return t=n.entityKey,d=g.pC(t).entityId,g.q(S,Ce(k.B,{mode:"readonly",PC:!0},function(a){var p=zi(a,t,"playbackData"),X=zi(a,g.S5(d,"offlineVideoPolicy"),"offlineVideoPolicy");a=zi(a,g.S5(d,"transfer"),"transfer");return g.Bh.all([p,X,a])}),2);
case 2:G=S.T;R=g.y(G);O=R.next().value;D=R.next().value;Z=R.next().value;x=O;w=D;T=Z;if(!x||!w)return S.return(jr(n,!0));J=[];E=((b=x)==null?0:b.playerResponseJson)?JSON.parse(x.playerResponseJson):null;if(!(T&&E&&k.q3.G("html5_refresh_deprecated_downloads"))){S.DH(3);break}L=ZBD(k,E,T);return g.q(S,xf_(k,T),4);case 4:J=S.T;case 3:B={lastPlayerResponseTimestampSeconds:x.playerResponseTimestamp,offlineToken:w.offlineToken,formatIds:J};h={};if((W=T)==null?0:W.maximumDownloadQuality)h.maximumDownloadQuality=
T.maximumDownloadQuality;g.Xh(S,5);e=void 0;return g.q(S,o1D(k,n),7);case 7:return e=S.T,g.Xh(S,8),g.q(S,Gt7(t,k.q3,{refreshData:B,v4:h,offlineSourceData:e,mediaCapabilities:L}),10);case 10:P=S.T;g.BI(S,9,5);break;case 8:return g.IJ(S,5),Q=$P(n)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",GX("PDE handleRefresh error"),S.return(jr(n,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Q,"DOWNLOAD_STATE_FAILED"));
case 9:return g.q(S,Df_(k,P,n),11);case 11:return S.return(jr(n,!0,P.orchestrationActions));case 5:return k$=g.IJ(S),M="PDE handleRefresh error",k$ instanceof Error&&(M="PDE handleRefresh error: "+k$.message),Gb="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y$="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k$ instanceof g.b4&&k$.type==="QUOTA_EXCEEDED"&&(Gb="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y$="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),GX(M),S.return(jr(n,
!1,void 0,Gb,Y$,"DOWNLOAD_STATE_FAILED"))}})},o1D=function(k,n){var t,d,G,R;
return g.H(function(O){if(O.B==1)return t=g.pC(n.entityKey).entityId,d=g.S5(t,"videoDownloadContextEntity"),g.q(O,pe(k.B,d,"videoDownloadContextEntity"),2);G=O.T;return(R=G)!=null&&R.offlineModeType?O.return({offlineModeType:G.offlineModeType}):O.return(void 0)})},Df_=function(k,n,t){var d,G,R,O,D;
return g.H(function(Z){if(Z.B==1){if(!n.frameworkUpdates||!g.z(n.frameworkUpdates,UF))return Z.return();if(!(g.z(n.frameworkUpdates,UF).mutations&&g.z(n.frameworkUpdates,UF).mutations.length>0&&g.z(n.frameworkUpdates,UF).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return Z.DH(2);d=g.pC(g.z(n.frameworkUpdates,UF).mutations[0].entityKey).entityId;return g.q(Z,B6(k.B,d),3)}if(Z.B!=2){G=Z.T;R=g.z(t.actionMetadata,P6);if(D=(O=R)==null?void 0:O.playlistId)G.playlistId=D;G.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.kl(k.q3)?g.q(Z,EF(d,k.B,t,k.C,G),2):g.NO(k.q3)?g.q(Z,I4(d,k.B,t,k.C),2):Z.DH(2)}return g.q(Z,rHk(g.z(n.frameworkUpdates,UF)),0)})},jr=function(k,n,t,d,G,R){return new FZ(n?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",$P(k),t,d,G,R)},ZBD=function(k,n,t){n=yBD(k.q3,t.cotn,n);
t=g.Zm(n);return g.HdE(n,t,k.q3)},xf_=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J;
return g.H(function(L){if(L.B==1)return t=[],g.q(L,Ce(k.B,{mode:"readonly",PC:!0},function(b){var E=[],B=n.offlineVideoStreams;if(B){B=g.y(B);for(var h=B.next();!h.done;h=B.next())E.push(zi(b,h.value,"offlineVideoStreams"))}return g.Bh.all(E)}),2);
if(d=L.T)for(G=g.y(d),R=G.next();!R.done;R=G.next())if(O=R.value,D=void 0,(D=O)==null?0:D.streamsProgress)for(Z=O.streamsProgress,x=0;x<Z.length;x++)w=Z[x],T=JSON.parse(w.formatStreamBytes),J={itag:T.itag,lmt:T.lastModified,xtags:T.xtags},t.push(J);return L.return(t)})},TGi=function(k,n){this.B=k;
this.q3=n},iB_=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L;
return g.H(function(b){switch(b.B){case 1:return t=$P(n),g.q(b,Sg(k.B,"videoPlaybackPositionEntity"),2);case 2:d=b.T;if(d.length===0)return b.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Xh(b,3);return g.q(b,Nq.getInstance(),5);case 5:G=b.T;if(!G)throw Error("prefStorage is undefined");return g.q(b,G.get("psi"),6);case 6:return R=b.T,Z=(D=(O=R)==null?void 0:O.vl)!=null?D:"0",g.q(b,t45(d,Z),7);case 7:return x=b.T,w={isPaused:x.watchHistoryPaused,vl:x.syncTimestampUsec},g.q(b,G.set("psi",
w),8);case 8:if(w.isPaused){b.DH(9);break}T=g.z(x.frameworkUpdates,UF);if(!x.frameworkUpdates||!T){b.DH(9);break}return g.q(b,rHk(T),9);case 9:g.BI(b,4);break;case 3:return J=g.IJ(b),L="PPE handleRefresh error: "+(J instanceof Error?J.message:"unknown error"),GX(L),b.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return b.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},L9f=function(k,n){var t,d,G,R,O,D,Z,x;
return g.H(function(w){switch(w.B){case 1:return t=$P(n),d=g.pC(n.entityKey).entityId,g.Xh(w,2),g.q(w,Nq.getInstance(),4);case 4:G=w.T;if(!G)throw Error("prefStorage is undefined");return g.q(w,G.get("psi"),5);case 5:R=w.T;O=g.z(n.actionMetadata,JKD);if(((D=R)==null?void 0:D.isPaused)!==!1||(Z=O)==null||!Z.lastPlaybackPositionSeconds){w.DH(6);break}x={key:g.S5(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:O.lastPlaybackPositionSeconds};return g.q(w,lJ(k.B,x,"videoPlaybackPositionEntity"),
6);case 6:g.BI(w,3);break;case 2:return g.IJ(w),w.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return w.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},bBf=function(k,n){var t,d,G;
return g.H(function(R){switch(R.B){case 1:t=$P(n);g.Xh(R,2);d=g.pC(n.entityKey).entityId;if(d==="!*$_ALL_ENTITIES_!*$")return g.q(R,enk(k.B),5);G=g.S5(d,"videoPlaybackPositionEntity");return g.q(R,qr9(k.B,G),5);case 5:g.BI(R,3);break;case 2:return g.IJ(R),R.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},mf_=function(k,n){this.api=k;
this.B=n;this.logger=new g.Zk("woffle");this.T=!1;this.fq={L_:this.L_};this.logger.debug("Initialized OfflineMediaManager")},yK5=function(k){return g.H(function(n){return n.return(KhC(k))})},sF5=function(k){var n;
return g.H(function(t){if(t.B==1)return g.q(t,g.Roz(k),2);n=t.T;return t.return(n.filter(function(d){return!!d.url}).map(function(d){return d.url}))})},rn=function(k,n){var t=g.HK(n);
if(t===1||t===0)return Promise.resolve();(t=X__(k,n))&&t.stopVideo();k.C=0;return yK5(n)},c6=function(k,n,t,d){t=t===void 0?!1:t;
d=d===void 0?!0:d;var G=typeof n==="string"?n:n.videoDetails.videoId;g.HK(G)===2&&((n=X__(k,G))?n.stopVideo():k.logger.info(function(){return"Corresponding player for "+G+" not found. Pausing anyway"}),g.FI(G,2),k.C=2,t?E1D(k.B):d&&UfW(k.B))},X__=function(k,n){var t;
return((t=k.player)==null?void 0:t.getVideoData().videoId)===n?k.player:null},BG5=function(k,n,t){n.getPlayerResponse();
g.FI(n.videoId,2);k.C=2;k.T=!1;var d;(d=k.player)==null||d.dispose();k.player=k.api.mq(n);n={};k.player.Bp((n.localmediachange=k.U2,n.signatureexpired=k.bU,n.statechange=k.PFX,n),k);var G=k.L_(t);k.player.B3(g.ol(G,G,!0,"m"),!1);k.logger.debug(function(){return"Starting headless playback with quality: "+G});
k.player.eX(!1)},IWG=function(k,n){this.B=k;
this.q3=n},V47=function(k,n){var t,d;
return g.H(function(G){switch(G.B){case 1:return t=$P(n),g.q(G,pe(k.B,n.entityKey,"transfer"),2);case 2:if(d=G.T)return G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Xh(G,3);return g.q(G,hi4(k,n),5);case 5:g.BI(G,4);break;case 3:return g.IJ(G),G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},AK4=function(k,n){var t,d;
return g.H(function(G){switch(G.B){case 1:return t=$P(n),g.q(G,pe(k.B,n.entityKey,"transfer"),2);case 2:d=G.T;if(!d||d.transferState!=="TRANSFER_STATE_COMPLETE")return G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Xh(G,3);return g.q(G,hi4(k,n,!0),5);case 5:g.BI(G,4);break;case 3:return g.IJ(G),G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},W9W=function(k,n){var t,d,G,R,O,D,Z,x,w,T;
return g.H(function(J){switch(J.B){case 1:return t=$P(n),d=g.pC(n.entityKey).entityId,g.q(J,Ce(k.B,{mode:"readonly",PC:!0},function(L){var b=zi(L,n.entityKey,"transfer");L=zi(L,g.S5(d,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Bh.all([b,L])}),2);
case 2:G=J.T;R=g.y(G);O=R.next().value;D=R.next().value;Z=O;x=D;if(!Z||Z.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return J.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Xh(J,3);Z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.q(J,lJ(k.B,Z,"transfer"),5);case 5:w=g.pC(Z.key).entityId;D2({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:w,TP:Z,offlineModeType:(T=x)==null?void 0:T.offlineModeType});g.BI(J,
4);break;case 3:return g.IJ(J),J.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},hi4=function(k,n,t){t=t===void 0?!1:t;
var d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h;return g.H(function(W){switch(W.B){case 1:return d=g.z(n.actionMetadata,qS9),G=g.pC(n.entityKey).entityId,R=g.S5(G,"downloadStatusEntity"),g.q(W,Ce(k.B,{mode:"readonly",PC:!0},function(e){var P=zi(e,R,"downloadStatusEntity");e=zi(e,g.S5(G,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Bh.all([P,e])}),2);
case 2:return O=W.T,D=g.y(O),Z=D.next().value,x=D.next().value,w=Z,T=x,J="TRANSFER_STATE_TRANSFER_IN_QUEUE",((L=w)==null?void 0:L.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(J="TRANSFER_STATE_PAUSED_BY_USER"),B={key:n.entityKey,transferState:J,cotn:g.In(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(b=d)==null?void 0:b.maximumDownloadQuality,preferredAudioTrack:(E=d)==null?void 0:E.preferredAudioTrack,transferRetryCount:0,isRefresh:t,hasLoggedFirstStarted:!1},g.q(W,Ce(k.B,
{mode:"readwrite",PC:!0},function(e){var P=[];t&&P.push(uJ(e,g.S5(G,"offlineVideoStreams")));P.push(vD(e,B,"transfer"));return g.Bh.all(P)}),3);
case 3:if(!t){W.DH(4);break}return g.q(W,yK5(G),4);case 4:D2({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:G,TP:B,offlineModeType:(h=T)==null?void 0:h.offlineModeType}),g.yq(W)}})},HB9=function(k,n,t,d){if(!k.action.entityKey)throw Error("entityKey is missing.");
var G=g.pC(k.action.entityKey);G={entityType:G.HS,entityId:G.entityId,offlineOrchestrationActionType:k.action.actionType,orchestrationAction:{orchestrationActionId:k.actionId}};n&&(G.offlineOrchestrationActionResult=n.status,G.isRetryable=t?!1:n.B,n.C&&(G.offlineOrchestrationFailureReason=eiO(n.C,G.isRetryable)));var R,O;if((R=k.action.actionMetadata)==null?0:(O=R.offlineLoggingData)==null?0:O.offlineModeType)G.offlineModeType=k.action.actionMetadata.offlineLoggingData.offlineModeType;d&&(G.additionalOrchestrationActions=
d.map(function(D){return{orchestrationActionId:D.actionId}}));
return G},eiO=function(k,n){return k!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||n?k==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&n?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":k:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},F9K=function(k,n){var t={offlineOrchestrationContext:HB9(k)};
n=pV5(n,t);Sr_(lqO(),n,k.rootActionId)},Pk5=function(k,n,t,d){d=d===void 0?[]:d;
n={offlineOrchestrationContext:HB9(k,n,t,d)};n=pV5(3,n);Sr_(lqO(),n,k.rootActionId)},jF5=function(){this.actions=[]},rK4=function(k,n){n=g.y(n);
for(var t=n.next();!t.done;t=n.next())t=t.value,F9K(t,1),k.actions.push(t);k.actions.sort(k.B)},cK5=function(k,n){if(n)for(var t=0;t<k.actions.length;t++)if(n==="!*$_ALL_ENTITIES_!*$"&&k.actions[t].actionId!==n||n!=="!*$_ALL_ENTITIES_!*$"&&k.actions[t].rootActionId===n&&k.actions[t].actionId!==n)k.actions.splice(t,1),t--},NG9=function(k,n){k=g.y(k.actions);
for(var t=k.next();!t.done;t=k.next())if(t.value.actionId===n)return!0;return!1},Na=function(k,n,t,d,G){g.N.call(this);
var R=this;this.T=k;this.Sm=n;this.xf=t;this.W=d;this.q3=G;this.B=new jF5;this.L=new g.ln;this.C=new g.CB(function(){R.retry()});
this.X=NaN;this.D=!1;this.fq={oAf:function(){return R.B},
zS:function(){return R.L},
nAf:function(){return R.C},
retry:function(){return R.retry()}};
g.f(this,this.C);this.K=this.T.observe(this.RS.bind(this))},zi5=function(k,n,t,d,G){var R;
return g.H(function(O){if(O.B==1)return R=new Na(k,n,t,d,G),g.q(O,fW5(R),2);QF9(R);return O.return(R)})},QF9=function(k){var n=k.B.actions[0];
return k.S?((n==null?void 0:n.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&k.S[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(k.D=!0),Promise.resolve()):aW4(k)},aW4=function(k){var n,t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h;
return g.H(function(W){switch(W.B){case 1:if(k.S)throw Error("Already processing an action");if(k.Ww())return W.return();n=k.B.actions.shift();xwC(k.xf,!n);if(n===void 0)return W.return();n.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&n.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&cK5(k.B,n.actionId);t="";n.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&n.rootActionId===n.actionId&&(t=n.actionId);d=[n];k.S=d;if(G=k.Sm[n.entityType]){W.DH(2);break}k.S=
void 0;return g.q(W,aW4(k),3);case 3:return W.return();case 2:R=g.y(d);for(O=R.next();!O.done;O=R.next())D=O.value,F9K(D,2);g.Xh(W,4,5);return g.q(W,OB5(G,d.map(function(e){return e.action})),7);
case 7:Z=W.T,x=g.y(d),w=x.next();case 8:if(w.done){W.DH(10);break}T=w.value;J=Z.get(T.action);return g.q(W,K94(k,T,J),9);case 9:w=x.next();W.DH(8);break;case 10:cK5(k.B,t);case 5:g.hj(W);k.S=void 0;g.Aj(W,6);break;case 4:return L=g.IJ(W),GX("Orchestration error",L),g.Xh(W,12),g.q(W,v1_(k,d),14);case 14:g.BI(W,5);break;case 12:b=g.IJ(W);GX("Orchestration retry error",b);E=g.y(d);for(B=E.next();!B.done;B=E.next())h=B.value,h.retryScheduleIndex<3&&rK4(k.B,[h]);W.DH(5);break;case 6:return g.q(W,aW4(k),
0)}})},K94=function(k,n,t){var d,G,R,O,D,Z,x,w,T,J,L,b;
return g.H(function(E){switch(E.B){case 1:d=n.retryScheduleIndex+2===3;if(t.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){E.DH(2);break}if(t.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){E.DH(0);break}Pk5(n,t,d);if(t.B&&n.retryScheduleIndex+1<3)return g.q(E,v1_(k,[n]),0);R=((G=t)==null?0:G.T)?t.T:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";O={entityKey:n.action.entityKey,failureReason:R};D=void 0;g.kl(k.q3)?D="mainVideoDownloadStateEntity":g.NO(k.q3)&&(D="musicTrackDownloadMetadataEntity");
if(!D||!t.downloadState){E.DH(7);break}Z=g.pC(n.action.entityKey).entityId;return g.q(E,TX(Z,D,k.T,t.downloadState),7);case 7:OF(k.W,O);if(t.downloadState==="DOWNLOAD_STATE_FAILED"&&k.q3.G("html5_auto_retry_failed_pde_actions")){E.DH(0);break}GX("Orchestration result is not retryable, deleting action");return g.q(E,qr9(k.T,y2(n).key),0);case 2:x=void 0;try{x=(w=t.S)==null?void 0:w.map(function(B){return k.createAction(B,n)})}catch(B){return Pk5(n,t,d),T={entityKey:n.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},OF(k.W,T),GX("Orchestration subactions creation error",B),E.return()}Pk5(n,t,d,x);if(!x){E.DH(12);break}J=x.map(function(B){return y2(B)});
L=0;case 13:if(!(L<x.length)||k.D){E.DH(15);break}return g.q(E,Ce(k.T,{mode:"readwrite",PC:!0},function(B){var h=[];h.push(seG(B,J.slice(L,L+10),"offlineOrchestrationActionWrapperEntity"));return g.Bh.all(h)}),16);
case 16:L+=10;E.DH(13);break;case 15:if(k.D)return k.D=!1,E.return();case 12:return b=y2(n),g.q(E,qr9(k.T,b.key),17);case 17:F9K(n,4),g.yq(E)}})},Ckf=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L;
return g.H(function(b){t=[];d=Infinity;G=4E3;R=g.y(n);for(O=R.next();!O.done;O=R.next())D=O.value,Z=Number(D.enqueueTimeSec),x=u5O(Z),w=D.retryScheduleIndex,T=w!=null&&w>0,x>0&&T?(d=Math.min(d,Z),G=Math.min(x,G)):t.push(D);isFinite(d)&&(!k.C.isActive()||d<k.X)&&(k.X=d,k.C.start(G));k.L.VF()||(J=t.length,t=t.filter(function(E){var B;E=((B=E.actionProto)==null?void 0:B.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!M4_.includes(E)}),L=t.length<J,!k.C.isActive()&&L&&k.C.start(1));
t.length>0&&g1G(k,t);return g.q(b,QF9(k),0)})},p_4=function(k){var n,t,d,G,R,O,D;
return g.H(function(Z){if(Z.B==1)return g.q(Z,lWO(k),2);n=Z.T;t=[];d=g.y(n);for(G=d.next();!G.done;G=d.next())R=G.value,O=g.pC(R.key),D=O.entityId,NG9(k.B,D)||t.push(R);return g.q(Z,Ckf(k,t),0)})},u5O=function(k){k=k*1E3-Date.now();
return k>4E3?4E3:k},v1_=function(k,n){var t,d,G;
return g.H(function(R){t=g.y(n);for(d=t.next();!d.done;d=t.next()){G=d.value;var O=void 0,D=void 0,Z=((D=G.action)==null?void 0:(O=D.actionMetadata)==null?void 0:O.retryScheduleIntervalsInSeconds)||[1,2,4];O=1;G.retryScheduleIndex<Z.length&&(O=Z[G.retryScheduleIndex]);G.B=O*1E3+Date.now();G.retryScheduleIndex++}return g.q(R,SSi(k,n),0)})},fW5=function(k){var n;
return g.H(function(t){if(t.B==1)return g.q(t,Sg(k.T,"offlineOrchestrationActionWrapperEntity"),2);n=t.T;return g.q(t,Ckf(k,n),0)})},g1G=function(k,n){n.length!==0&&n.forEach(function(t){t=mN(t);
t.retryScheduleIndex<3&&rK4(k.B,[t])})},lWO=function(k,n){var t;
return g.H(function(d){if(d.B==1)return g.q(d,Sg(k.T,"offlineOrchestrationActionWrapperEntity",n),2);t=d.T;return d.return(t.filter(cHD))})},SSi=function(k,n){if(n.length===0)return Promise.resolve([]);
n=n.map(function(t){return y2(t)});
return WhW(k.T,n)},k69=function(k){this.aS=k;
this.B=void 0},nbf=function(k,n){var t,d,G,R;
return g.H(function(O){t=n.videoId;d=!0;if(n.captionTracks.length)G=Lyk(n),k.B=new g.m8(k.aS,n,G);else if(n.l0)R=g.T8h(n),k.B=new g.s2(k.aS,n.l0,t,R,n.Nn,n.eventId),d=n.Nn;else return O.return();return O.return(new Promise(function(D){var Z;(Z=k.B)==null||Z.mm({mx:function(){return g.H(function(x){if(x.B==1)return g.q(x,k.mx(t,d),2);D();g.yq(x)})},
HN:function(){}})}))})},tXK=function(k){var n;
return g.H(function(t){if(t.B==1)return g.q(t,aqC(k),2);n=t.T;return t.return(!!n&&n.length>0)})},f3=function(k){g.N.call(this);
this.B=k;this.T=this.B.observe(this.C.bind(this))},dkO=function(k,n){var t,d,G,R,O,D,Z;
return g.H(function(x){switch(x.B){case 1:if(n.length===0)return x.return([]);t=n.map(function(w){return g.S5(w,"transfer")});
return g.q(x,Sg(k.B,"transfer",t),2);case 2:d=x.T;G=d.filter(cHD).map(function(w){return g.pC(w.key).entityId});
R=n.filter(function(w){return G.indexOf(w)===-1});
if(R.length===0)return x.return([]);O=g.y(R);D=O.next();case 3:if(D.done){x.DH(5);break}Z=D.value;return g.q(x,yK5(Z),4);case 4:D=O.next();x.DH(3);break;case 5:return x.return(R)}})},O7G=function(k,n,t,d,G,R){var O,D,Z;
return g.H(function(x){O="STREAM_TYPE_UNKNOWN";t.video&&t.audio?(O="STREAM_TYPE_AUDIO_AND_VIDEO",GX("unexpected stream type")):t.video&&!t.audio?O="STREAM_TYPE_VIDEO":!t.video&&t.audio&&(O="STREAM_TYPE_AUDIO");D=g.S5(n,"offlineVideoStreams");Z={numBytesDownloaded:G.toFixed(),numTotalBytes:R.toFixed(),streamType:O,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(d),itag:O==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(t.itag):void 0};return g.q(x,Ce(k,{mode:"readwrite",PC:!0},
function(w){var T=zi(w,D,"offlineVideoStreams"),J=zi(w,g.S5(n,"transfer"),"transfer");return g.Bh.all([T,J]).then(function(L){L=g.y(L);var b=L.next().value;L=L.next().value;if(!L)return uJ(w,D).then(function(){});
var E=G6C(b);b=Rw7(b,d,Z,D);var B=vD(w,b,"offlineVideoStreams");G6C(b)>E&&(L.lastProgressTimeMs=Date.now().toString());E=[B];L.offlineVideoStreams||(L.offlineVideoStreams=[]);L.offlineVideoStreams.indexOf(D)===-1&&(L.offlineVideoStreams.push(D),E.push(vD(w,L,"transfer")));return g.Bh.all(E)})}),0)})},Yo5=function(k,n){var t,d,G,R,O;
return g.H(function(D){if(D.B==1)return t=g.S5(n,"offlineVideoStreams"),g.q(D,pe(k,t,"offlineVideoStreams"),2);d=D.T;if(!d||!d.streamsProgress)return D.return();G=g.y(d.streamsProgress);for(R=G.next();!R.done;R=G.next())O=R.value,O.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",O.numTotalBytes!==O.numBytesDownloaded&&(O.numBytesDownloaded=O.numTotalBytes);return g.q(D,lJ(k,d,"offlineVideoStreams"),0)})},Rw7=function(k,n,t,d){if(k&&k.streamsProgress){d=k;
a:{n=n.itag+";"+n.xtags;for(var G=k.streamsProgress,R=0;R<G.length;R++){var O=JSON.parse(G[R].formatStreamBytes);if(O.itag+";"+O.xtags===n){G[R]=t;t=G;break a}}G.push(t);t=G}d.streamsProgress=t}else k={key:d,streamsProgress:[t]};return k},G6C=function(k){if(k==null?0:k.streamsProgress){var n=0;
k=k.streamsProgress;for(var t=0;t<k.length;t++){var d=k[t];isNaN(Number(d.numBytesDownloaded))?GX("stream progress bytes number invalid"):n+=Number(d.numBytesDownloaded)}return n}return 0},obf=function(k,n,t,d){g.N.call(this);
var G=this;this.T=k;this.api=n;this.J8=t;this.RS=d;this.L=new g.ln;this.S=new g.CB(function(){G.B&&G.B.transferState==="TRANSFER_STATE_TRANSFERRING"&&G.L.VF()&&((G.B.transferRetryCount||0)<3?c6(G.W,G.D,!1,!1):rn(G.W,G.D.videoDetails.videoId),G.G6("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.xf=this.FX=0;this.K=this.X=!1;this.IS=g.iK(this.api.V().experiments,"html5_transfer_processing_logs_interval");this.EE=new g.ct(this);this.fq={VsS:function(){return G.S},
NhH:function(){return G.RS},
zS:function(){return G.L}};
this.Sm=this.T.observe(this.iQ.bind(this));this.W=new mf_(n,this);this.t8=new k69(n);this.Lf=new f3(this.T);this.kf=this.L.listen("publicytnetworkstatus-online",this.vn.bind(this));this.uf=this.L.listen("publicytnetworkstatus-offline",this.qmV.bind(this));this.K=this.api.V().G("html5_less_transfer_processing_logs");g.f(this,this.EE);this.EE.J(n,"offlinetransferpause",this.wok);g.kl(this.api.V())?this.C="mainVideoDownloadStateEntity":g.NO(this.api.V())&&(this.C="musicTrackDownloadMetadataEntity")},
DkW=function(k){return g.H(function(n){if(n.B==1)n=g.q(n,Qe7(),2);
else{var t=k.Lf;var d=g.ed();d=Object.keys(d);t=dkO(t,d);n=g.q(n,t,0)}return n})},zX=function(k,n){n=n===void 0?!1:n;
var t;return g.H(function(d){if(d.B==1){if(k.B)throw Error("Already downloading a video");k.xf=0;k.X=!1;return g.q(d,$km(k),2)}return d.B!=4?(t=d.T,wj5(k.J8,!t),t&&k.L.VF()?n?g.q(d,new Promise(function(G){g.LT(G,1E3)}),4):d.DH(4):(!t&&k.B&&Q2(k),d.DH(0))):g.q(d,Z7K(k,t),0)})},xkO=function(k){return g.H(function(n){if(n.B==1)return k.D?g.q(n,rn(k.W,k.D.videoDetails.videoId),3):n.DH(0);
Q2(k);g.yq(n)})},wH5=function(k,n){var t,d,G;
return g.H(function(R){switch(R.B){case 1:return g.Xh(R,2),(t=!!n.captionTracks.length||!!n.l0)?g.q(R,tXK(n.videoId),4):R.return();case 4:return(d=R.T)?R.return():g.q(R,nbf(k.t8,n),5);case 5:g.BI(R,0);break;case 2:G=g.IJ(R),GX("Caption downloading error",G,n.cotn),g.yq(R)}})},Z7K=function(k,n){var t,d,G,R,O,D;
return g.H(function(Z){switch(Z.B){case 1:if(k.X)return Z.return();k.X=!0;k.B=n;t=g.pC(k.B.key);d=t.entityId;G=void 0;if(k.B.transferState==="TRANSFER_STATE_TRANSFERRING")return g.q(Z,a4(k,d),7);if(k.B.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||k.B.transferRetryCount||k.B.hasLoggedFirstStarted){Z.DH(3);break}return g.q(Z,a4(k,d),5);case 5:return G=Z.T,k.B.hasLoggedFirstStarted=!0,g.q(Z,THG(k),6);case 6:TsO({videoId:d,TP:k.B,offlineModeType:G},void 0,void 0,!0);Z.DH(3);break;case 7:G=Z.T,
D2({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:d,TP:k.B,offlineModeType:G});case 3:return g.q(Z,i75(k),8);case 8:return R=null,g.Xh(Z,9),g.q(Z,JDK(k,n),11);case 11:R=Z.T;k.D=R;g.BI(Z,10);break;case 9:return O=g.IJ(Z),GX("error getting player response",O,n.cotn),g.q(Z,k.G6("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return Z.return();case 10:return D=yBD(k.api.V(),n.cotn,R),g.q(Z,wH5(k,D),13);case 13:return g.q(Z,sF5(D.videoId),
14);case 14:D.m7=Z.T,BG5(k.W,D,n.maximumDownloadQuality),k.S.start(108E5),g.yq(Z)}})},$km=function(k){var n,t;
return g.H(function(d){if(d.B==1)return g.q(d,Sg(k.T,"transfer"),2);n=d.T;t=n.filter(L5_).sort(b77);return t.length===0?d.return():d.return(t[0])})},i75=function(k){var n,t,d;
return g.H(function(G){if(G.B==1){if(!k.B)return K3(k,"onTransferStart"),G.return();k.S.start(108E5);return g.q(G,v6(k,"TRANSFER_STATE_TRANSFERRING"),2)}n=k.B;return(d=((t=n)==null?0:t.key)?g.pC(n.key).entityId:"")&&k.C?g.q(G,TX(d,k.C,k.T,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):G.DH(0)})},E1D=function(k){var n,t,d,G;
g.H(function(R){switch(R.B){case 1:if(!k.B){K3(k,"onTransferPausedByUser");R.DH(2);break}n=k.B;k.S.stop();return g.q(R,v6(k,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:d=((t=n)==null?0:t.key)?g.pC(n.key).entityId:"";if(!d||!k.C){R.DH(4);break}return g.q(R,TX(d,k.C,k.T,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.q(R,a4(k,d),6);case 6:G=R.T,iSk({videoId:d,TP:n,offlineModeType:G});case 2:Q2(k),zX(k),g.yq(R)}})},UfW=function(k){var n,t,d;
g.H(function(G){if(G.B==1){if(!k.B)return K3(k,"onTransferPausedByNetwork"),G.return();k.S.stop();return g.q(G,v6(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(G.B!=3)return n=k.B,(d=((t=n)==null?0:t.key)?g.pC(n.key).entityId:"")&&k.C?g.q(G,TX(d,k.C,k.T,"DOWNLOAD_STATE_PAUSED"),3):G.DH(3);Q2(k);g.yq(G)})},mki=function(k){var n,t,d,G,R;
g.H(function(O){switch(O.B){case 1:if(!k.B)return K3(k,"onTransferComplete"),O.return();n=k.B;k.S.stop();if(!n||!k.D){O.DH(2);break}t=yBD(k.api.V(),n.cotn,k.D);return g.q(O,wH5(k,t),2);case 2:return g.q(O,v6(k,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:G=((d=n)==null?0:d.key)?g.pC(n.key).entityId:"";if(!G||!k.C){O.DH(5);break}return g.q(O,TX(G,k.C,k.T,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.q(O,Yo5(k.T,G),7);case 7:return g.q(O,a4(k,G),8);case 8:R=O.T,D2({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:G,TP:n,offlineModeType:R}),Q2(k),zX(k),g.yq(O)}})},yDO=function(k,n,t){var d,G;
g.H(function(R){switch(R.B){case 1:if(!k.B)return K3(k,"onTransferProgress: "+n),R.return();if(k.B.transferState==="TRANSFER_STATE_TRANSFERRING"){R.DH(2);break}return g.q(R,i75(k),2);case 2:d=Date.now();if(!(d-k.FX>1E3)){R.DH(4);break}k.FX=d;return g.q(R,O7G(k.T,t.videoId,t.T,t.HO,t.bytesDownloaded,t.B),5);case 5:if(k.K&&!(k.K&&d-k.xf>k.IS)){R.DH(4);break}k.xf=d;return g.q(R,a4(k,n),7);case 7:G=R.T,TsO({videoId:n,TP:k.B,offlineModeType:G},t.bytesDownloaded,t.B);case 4:k.S.start(108E5),g.yq(R)}})},
sb4=function(k){var n=(k.B.transferRetryCount||0)<3;
n&&(k=k.B,k.transferRetryCount=(k.transferRetryCount||0)+1);return n},XH9=function(k,n){n=n===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":n;
var t,d,G,R;return g.H(function(O){if(O.B==1)return k.B||K3(k,"setTransferToFailed: "+n),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n==="TRANSFER_FAILURE_REASON_NETWORK"?t="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":n==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.q(O,v6(k,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",n),2);if(O.B!=3)return OF(k.RS,{entityKey:(d=k.B)==null?void 0:d.key,failureReason:t}),
G=k.B?g.pC(k.B.key).entityId:"",g.q(O,a4(k,G),3);R=O.T;var D={videoId:G,TP:k.B,offlineModeType:R},Z=n,x={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};Z&&(x.transferFailureReason=Z,x.failureReason=JBO(Z));D2(x,D);g.yq(O)})},v6=function(k,n,t,d){var G;
return g.H(function(R){if(R.B==1){if(!k.B)return K3(k,"saveTransferState: "+n),R.return();k.B.transferState=n;k.B.failureReason=d;g.Xh(R,2);return g.q(R,THG(k,function(O){return t?aZ(O,"offlineVideoStreams",k.B.offlineVideoStreams).then(function(D){for(var Z=g.y(D),x=Z.next();!x.done;x=Z.next())if((x=x.value)&&x.streamsProgress){x=g.y(x.streamsProgress);for(var w=x.next();!w.done;w=x.next())w.value.streamState=t}return seG(O,D.filter(function(T){return!!T}),"offlineVideoStreams")}):g.Bh.resolve(void 0)}),
4)}if(R.B!=2)return g.BI(R,0);
G=g.IJ(R);return G instanceof g.b4&&G.type==="QUOTA_EXCEEDED"?g.q(R,k.G6("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):R.DH(0)})},THG=function(k,n){var t;
return g.H(function(d){if(!k.B)return d.return();t=k.B;return g.q(d,Ce(k.T,{mode:"readwrite",PC:!0},function(G){var R=[vD(G,t,"transfer")];n&&R.push(n(G));return g.Bh.all(R)}),0)})},Q2=function(k){k.B=void 0;
k.D=void 0;k.S.stop()},JDK=function(k,n){var t,d,G,R,O;
return g.H(function(D){if(D.B==1)return t=g.pC(n.key),d=t.entityId,G=g.S5(d,"playbackData"),g.q(D,pe(k.T,G,"playbackData"),2);R=D.T;if((O=R)==null?0:O.playerResponseJson)return D.return(JSON.parse(R.playerResponseJson));throw Error("No PlayerResponse found");})},K3=function(k,n){k.api.QV("woffle",{mcte:n});
GX("missing current transfer entity.")},a4=function(k,n){var t,d,G;
return g.H(function(R){if(R.B==1)return g.q(R,pe(k.T,g.S5(n,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);t=R.T;return R.return((G=(d=t)==null?void 0:d.offlineModeType)!=null?G:void 0)})},L5_=function(k){return EbC[k.transferState]!==void 0},b77=function(k,n){var t=EbC[k.transferState],d=EbC[n.transferState];
return t!==d?t-d:Number(k.enqueuedTimestampMs)-Number(n.enqueuedTimestampMs)},uw=function(k,n){var t=this;
this.q3=k;this.api=n;this.L=new g.ln;this.D=new g.Bo;this.fq={cq:function(){return t.C.fq.cq()},
zS:function(){return t.L},
L08:function(){return t.C},
uO:function(){return t.uO()},
A7:function(){return t.A7()},
jN:function(){return t.jN()},
xU:function(){return t.xU()},
Hd:function(){return t.Hd()},
gE:function(d){return t.gE(d)}};
this.C=new DwK(function(){return Uk4(t)},function(){t.jN()},this.api.JN(),this.api.G.bind(this.api));
this.B=new R4(this.api);$wD(this.C)},Uk4=function(k){return g.H(function(n){k.api.A8("onOrchestrationBecameLeader");
return g.q(n,k.A7(),0)})},IE5=function(k){var n,t;
return g.H(function(d){if(d.B==1)return g.q(d,kP(),2);if(d.B!=3){n=d.T;if(!n)return GX("PES is undefined"),d.return();k.T=new obf(n,k.api,k.C,k.B);t=k.dc(n);return g.q(d,zi5(n,t,k.C,k.B,k.q3),3)}k.W=d.T;return g.q(d,BHi(k),0)})},BHi=function(k){var n;
return g.H(function(t){switch(t.B){case 1:if(!k.T)return GX("transferManager is undefined"),t.return();if(k.T.B){t.DH(2);break}return g.q(t,zX(k.T),2);case 2:if(!k.q3.G("woffle_enable_main_downloads_library")){t.DH(4);break}return g.q(t,k.Yx(),4);case 4:if(!k.q3.G("html5_offline_playback_position_sync")){t.DH(6);break}return g.q(t,k.C6(),7);case 7:return g.q(t,k.gE(864E5),6);case 6:return g.q(t,k.refreshAllStaleEntities(43200,!0),9);case 9:return g.q(t,k.q8(),10);case 10:if(!k.q3.G("html5_retry_downloads_for_expiration")){t.DH(11);
break}return g.q(t,k.Hd(),11);case 11:return k.X=g.bo(function(){k.refreshAllStaleEntities(43200,!0);k.q8()},9E5),g.ka(g.tR(),function(){return k.xU()}),g.q(t,kP(),13);
case 13:return n=t.T,g.q(t,osk(n),14);case 14:ZSm(k.C),g.yq(t)}})},hw9=function(){var k,n,t,d,G,R;
return g.H(function(O){switch(O.B){case 1:return g.q(O,kP(),2);case 2:k=O.T;if(!k)return O.return([]);n=Date.now()/1E3;return g.q(O,Sg(k,"offlineVideoPolicy"),3);case 3:t=O.T,d=g.y(t),G=d.next();case 4:if(G.done){O.DH(6);break}R=G.value;if(!(R.expirationTimestamp&&Number(R.expirationTimestamp)<n)){O.DH(5);break}R.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";R.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.q(O,lJ(k,R,"offlineVideoPolicy"),5);
case 5:G=d.next();O.DH(4);break;case 6:return O.return(t.map(function(D){return D.key}))}})},Ma=function(k,n,t,d,G){var R,O,D;
return g.H(function(Z){if(Z.B==1)return g.q(Z,kP(),2);R=Z.T;if(!R)return Z.return([]);O=n.map(function(x){var w=g.S5(x,t);w={actionType:d,entityKey:w,actionMetadata:Object.assign({},s84(),G)};d!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(w.actionMetadata.priority=0);x=new bw(t,x,w);return y2(x)});
D=WhW(R,O);$wD(k.C);return Z.return(D)})},VXC=function(k,n,t,d){var G,R,O,D,Z,x,w,T;
return g.H(function(J){switch(J.B){case 1:G=[],R=g.y(n),O=R.next();case 2:if(O.done){J.DH(4);break}D=O.value;if(D.upToDate||t&&!D.shouldAutoSyncMetadata||!D.playlistId){J.DH(3);break}Z={};switch(d){case "mainPlaylistEntity":x={nextAutoRefreshIntervalSeconds:D.checkInSeconds,autoSync:t};Z={mainPlaylistEntityActionMetadata:x};break;case "musicPlaylist":w={autoSync:t},Z={musicPlaylistEntityActionMetadata:w}}return g.q(J,Ma(k,[D.playlistId],d,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z),6);case 6:(T=
J.T)&&G.push.apply(G,g.U(T));case 3:O=R.next();J.DH(2);break;case 4:return J.return(G)}})},AD5=function(k,n){var t;
return g.H(function(d){return n.length?(t=s84(),g.am(t,P6,{isEnqueuedForExpiredStreamUrlRefetch:!0}),k.api.QV("qrd",{v:n.length}),d.return(Ma(k,n,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t))):d.return([])})},W5G=function(k,n,t){this.B=k;
this.q3=n;this.C=t},H7D=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W;
return g.H(function(e){switch(e.B){case 1:return t=$P(n),d=g.pC(n.entityKey),G=d.entityId,R=[],g.Xh(e,2),g.q(e,qoC(k,G),4);case 4:R=e.T;if(!(k.q3.G("woffle_enable_main_downloads_library")&&((O=R)==null?0:O.length))){e.DH(5);break}return g.q(e,FGf(k.B,[n.entityKey]),5);case 5:g.BI(e,3);break;case 2:return D=g.IJ(e),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.b4&&D.type==="QUOTA_EXCEEDED"?(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):GX("Playlist add error"),e.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Z,x));case 3:w=[];if(!k.q3.G("html5_offline_prevent_redownload_downloaded_video")){e.DH(7);break}return g.q(e,mw4(k.B,"mainVideoEntity",R),8);case 8:R=e.T;case 7:if((T=R)==null?0:T.length)for(J=g.y(R),L=J.next();!L.done;L=J.next())if(b=L.value,E=b.offlineVideoData,B=void 0,(B=E)==null?0:B.videoId)h=void 0,W=Number(((h=n.actionMetadata)==null?void 0:h.priority)||
0)+1,w.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",E.videoId,"mainVideoEntity",W,gn,ewO(n,E,G)));return e.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,w))}})},PUk=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk,DG,yD,I,V,A,F,r,nw,RJ,Ot,c,Et,oJ,D7,PI,pw,zm,ke,MI,Cl,zP,bl,Mz,T7,C9,aW,lq,Ud,iX,FP,mv,PG,up,MQ,VT,dD,p9,oW,c_,Su;
return g.H(function(bj){switch(bj.B){case 1:return t=$P(n),d=n.entityKey,G=g.pC(d).entityId,R=[],O=!1,G==="!*$_ALL_ENTITIES_!*$"?(O=!0,g.q(bj,Sg(k.B,"mainPlaylistEntity"),5)):g.q(bj,pe(k.B,d,"mainPlaylistEntity"),4);case 4:(D=bj.T)&&R.push(D);bj.DH(3);break;case 5:R=bj.T;case 3:if((Z=R)==null||!Z.length)return bj.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));x=g.z(n.actionMetadata,F5k);T=(w=x)==null?void 0:w.nextAutoRefreshIntervalSeconds;L=(J=x)==null?void 0:J.autoSync;b=[];B=E=
!0;h=!1;if(!O&&L===!1){bj.DH(6);break}g.Xh(bj,7);return g.q(bj,gs_(0,!!L,!0,R),9);case 9:b=bj.T;g.BI(bj,8);break;case 7:W=g.IJ(bj);if(!(W instanceof Error&&W.message==="No data")){W instanceof Error&&W.message==="Empty response body"&&GX(W.message);bj.DH(8);break}return G==="!*$_ALL_ENTITIES_!*$"?g.q(bj,VyK(k.B,n,k.C,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.q(bj,IxC(G,k.B,n,k.C),8);case 8:if(!b.length||!O&&b[0].playlistId!==G)return bj.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));case 6:if(O){e=[];P=g.y(b);for(Q=P.next();!Q.done;Q=P.next())k$=Q.value,k$.upToDate||L&&!k$.shouldAutoSyncMetadata||!k$.playlistId||(M={nextAutoRefreshIntervalSeconds:k$.checkInSeconds,autoSync:L},e.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k$.playlistId,"mainPlaylistEntity",0,gn,{mainPlaylistEntityActionMetadata:M})));return bj.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,e))}b.length&&(Gb=b[0],h=!!Gb.upToDate,L&&(E=(Y$=Gb.shouldAutoSyncMetadata)!=null?Y$:!0,B=(S=Gb.shouldAutoSyncVideos)!=
null?S:!0,Gb.checkInSeconds&&(T=Gb.checkInSeconds)));if(h||!E)return bj.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));a=[];p=R[0];if(!p.downloadState){X=void 0;bj.DH(15);break}return g.q(bj,pe(k.B,p.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:X=bj.T;case 15:return K=X,hk=((zb=K)==null?0:zb.addedTimestampMillis)?String(K.addedTimestampMillis):void 0,g.Xh(bj,17),g.q(bj,qoC(k,G,hk,T),19);case 19:a=bj.T;g.BI(bj,18);break;case 17:m_=g.IJ(bj);if(!(m_ instanceof Error&&
m_.message==="No data for playlist")){if(m_ instanceof Error&&m_.message==="Empty response body for playlist")GX(m_.message);else return Vq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",tk="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m_ instanceof g.b4&&m_.type==="QUOTA_EXCEEDED"&&(Vq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",tk="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),bj.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Vq,tk));bj.DH(18);
break}return g.q(bj,IxC(G,k.B,n,k.C),18);case 18:if(!B)return bj.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));DG=[];yD=new Map;if((I=a)==null?0:I.length)for(V=g.y(a),A=V.next();!A.done;A=V.next())F=A.value,r=F.offlineVideoData,nw=void 0,((nw=r)==null?0:nw.videoId)&&yD.set(r.videoId,r);RJ=new Map;Ot=[];if((c=p)==null?0:(Et=c.videos)==null?0:Et.length)for(oJ=g.y(p.videos),D7=oJ.next();!D7.done;D7=oJ.next())if(PI=D7.value,pw=JSON.parse(g.pC(PI).entityId),zm=pw.videoId)yD.has(zm)?(RJ.set(zm,
yD.get(zm)),yD.delete(zm)):Ot.push(zm);MI=Number(((ke=n.actionMetadata)==null?void 0:ke.priority)||0)+1;Cl=g.y(yD.entries());for(zP=Cl.next();!zP.done;zP=Cl.next())bl=zP.value,Mz=g.y(bl),T7=Mz.next().value,C9=Mz.next().value,aW=T7,lq=C9,DG.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",aW,"mainVideoEntity",MI,gn,ewO(n,lq,G)));Ud=g.y(RJ.entries());for(iX=Ud.next();!iX.done;iX=Ud.next())FP=iX.value,mv=g.y(FP),PG=mv.next().value,up=mv.next().value,MQ=PG,VT=up,DG.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
MQ,"mainVideoEntity",MI,gn,ewO(n,VT,G)));dD=g.y(Ot);for(p9=dD.next();!p9.done;p9=dD.next())oW=p9.value,c_={playlistId:G},Su={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:c_},DG.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",oW,"mainVideoEntity",0,gn,Su));return bj.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,DG))}})},jbC=function(k,n){var t,d,G,R;
return g.H(function(O){switch(O.B){case 1:return t=$P(n),g.Xh(O,2),d=g.pC(n.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.q(O,VyK(k.B,n,k.C,(G=n.actionMetadata)==null?void 0:(R=G.offlineLoggingData)==null?void 0:R.offlineDeleteReason),5):g.q(O,IxC(d,k.B,n,k.C),6);case 6:if(!k.q3.G("woffle_enable_main_downloads_library")){O.DH(5);break}return g.q(O,PL4(k.B,n.entityKey),5);case 5:g.BI(O,3);break;case 2:return g.IJ(O),O.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},qoC=function(k,n,t,d){var G,R,O,D,Z,x,w;
return g.H(function(T){switch(T.B){case 1:return g.q(T,uJ4([n]),2);case 2:return G=T.T,g.q(T,rDW(k,G[0],t,d),3);case 3:return R=T.T,O=R.mainPlaylistEntity,D=R.fcf,x=Uwm(O,(Z=D)==null?void 0:Z.avatar),g.Xh(T,4),g.q(T,XZ(x),6);case 6:g.BI(T,5);break;case 4:w=g.IJ(T),w instanceof Error&&w.message==="Failed to fetch"&&GX(w.message);case 5:return T.return(G[0].videos)}})},rDW=function(k,n,t,d){var G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P;
return g.H(function(Q){switch(Q.B){case 1:G=Date.now().toString();t||(t=G);R=n.videos;O=n.playlistId;D=[];Z=[];if(R)for(x=g.y(R),w=x.next();!w.done;w=x.next()){T=w.value;J=T.offlineVideoData;if(!J||!J.videoId)throw GX("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");L=J.videoId;b={videoId:L,playlistId:O};E={id:g.S5(JSON.stringify(b),"mainPlaylistVideoEntity"),video:g.S5(L,"mainVideoEntity")};D.push(E);Z.push(E.id)}h={key:g.S5(O,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:t,lastSyncedTimestampMillis:G};W={key:g.S5(O,"mainPlaylistEntity"),playlistId:O,videos:Z,title:n.title,thumbnailStyleData:cD9(n),visibility:NH5(n),downloadState:h.key};n.channel&&(e=n.channel.offlineChannelData,B=fE_(g.S5(O,"ytMainChannelEntity"),e),W.channelOwner=B.id);((P=W)==null?0:P.entityMetadata)?(W.entityMetadata.offlineLastModifiedTimestampSeconds=n.lastModifiedTimestamp,d&&(W.entityMetadata.nextAutoRefreshIntervalSeconds=String(d))):W&&(W.entityMetadata={nextAutoRefreshIntervalSeconds:d?
String(d):void 0,offlineLastModifiedTimestampSeconds:n.lastModifiedTimestamp});g.Xh(Q,2);return g.q(Q,Ce(k.B,{mode:"readwrite",PC:!0},function(k$){var M=vD(k$,W,"mainPlaylistEntity"),Gb=vD(k$,h,"mainPlaylistDownloadStateEntity");M=[M,Gb];Gb=g.y(D);for(var Y$=Gb.next();!Y$.done;Y$=Gb.next())M.push(vD(k$,Y$.value,"mainPlaylistVideoEntity"));B&&M.push(vD(k$,B,"ytMainChannelEntity"));return g.Bh.all(M)}),4);
case 4:g.BI(Q,3);break;case 2:throw g.IJ(Q),GX("PES failure for playlist"),Error("PES failure for playlist");case 3:return Q.return({mainPlaylistEntity:W,fcf:B,adH:D})}})},fE_=function(k,n){return{id:k,
channelId:n.channelId,title:n.title,avatar:n.thumbnail}},cD9=function(k){var n=[],t=k.videos;
t&&t.length>0&&n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:t[0].offlineVideoData.thumbnail}}});if((k=k.additionalMetadadatas)&&k.length>0)for(k=g.y(k),t=k.next();!t.done;t=k.next()){var d=t.value.offlineBundleItemPlaylistData,G=void 0;t=(G=d)==null?void 0:G.style;G=void 0;d={collageThumbnail:{coverThumbnail:(G=d)==null?void 0:G.coverThumbnail}};switch(t){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:d});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:d});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:d});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:d})}}return n},NH5=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ewO=function(k,n,t){n={offlineVideoData:n,
playlistId:t};if(k=g.z(k.actionMetadata,F5k))n.maximumDownloadQuality=k.maximumDownloadQuality;return{mainVideoEntityActionMetadata:n}},Qb9=function(k,n,t){this.B=k;
this.q3=n;this.C=t},K5K=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b;
return g.H(function(E){switch(E.B){case 1:return t=$P(n),d=g.pC(n.entityKey),G=d.entityId,R=g.z(n.actionMetadata,C3),D=!((O=R)==null?0:O.playlistId),g.Xh(E,2),g.q(E,zw5(k,G,void 0,(Z=R)==null?void 0:Z.offlineVideoData,D),4);case 4:g.BI(E,3);break;case 2:return x=g.IJ(E),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.b4&&x.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
E.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,w,T));case 3:J=1;J=Number(((L=n.actionMetadata)==null?void 0:L.priority)||0)+1;var B=(B=g.z(n.actionMetadata,C3))?{playbackDataActionMetadata:{maximumDownloadQuality:B.maximumDownloadQuality}}:void 0;b=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G,"playbackData",J,aE9,B);return E.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,[b]))}})},vbk=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W;
return g.H(function(e){switch(e.B){case 1:return t=$P(n),d=g.pC(n.entityKey),G=d.entityId,g.q(e,pe(k.B,n.entityKey,"mainVideoEntity"),2);case 2:R=e.T;if(!R){O=void 0;e.DH(3);break}return g.q(e,pe(k.B,R.downloadState,"mainVideoDownloadStateEntity"),4);case 4:O=e.T;case 3:D=O;if(!R||!D)return e.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Xh(e,5);return g.q(e,zw5(k,G,D.addedTimestampMillis,(x=g.z(n.actionMetadata,C3))==null?void 0:x.offlineVideoData),7);case 7:w=1;w=Number(((T=
n.actionMetadata)==null?void 0:T.priority)||0)+1;Z=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G,"playbackData",w,aE9);g.BI(e,6);break;case 5:J=g.IJ(e);if(!(J instanceof Error&&J.message==="No data")){if(J instanceof Error&&J.message==="Empty response body")GX(J.message);else return L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.b4&&J.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,L,b));e.DH(6);break}return g.q(e,B6(k.B,G),9);case 9:E=e.T;B=g.z(n.actionMetadata,C3);if(W=(h=B)==null?void 0:h.playlistId)E.playlistId=W;E.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.q(e,EF(G,k.B,n,k.C,E),6);case 6:return e.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,Z?[Z]:void 0))}})},uSO=function(k,n){var t,d,G,R,O,D,Z,x,w,T;
return g.H(function(J){switch(J.B){case 1:return t=$P(n),g.Xh(J,2),d=g.pC(n.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.q(J,VyK(k.B,n,k.C,(w=n.actionMetadata)==null?void 0:(T=w.offlineLoggingData)==null?void 0:T.offlineDeleteReason),5):g.q(J,B6(k.B,d),6);case 6:G=J.T;R=g.z(n.actionMetadata,C3);if(D=(O=R)==null?void 0:O.playlistId)G.playlistId=D;G.offlineDeleteReason=(Z=n.actionMetadata)==null?void 0:(x=Z.offlineLoggingData)==null?void 0:x.offlineDeleteReason;return g.q(J,EF(d,k.B,n,k.C,G),7);
case 7:if(!k.q3.G("woffle_enable_main_downloads_library")){J.DH(5);break}return g.q(J,PL4(k.B,n.entityKey),5);case 5:g.BI(J,3);break;case 2:return g.IJ(J),J.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},zw5=function(k,n,t,d,G){var R,O,D,Z,x,w;
return g.H(function(T){switch(T.B){case 1:if(R=d){T.DH(2);break}return g.q(T,vsD([n]),3);case 3:O=T.T,R=O[0];case 2:return g.q(T,MX_(k,R,t,G),4);case 4:D=T.T;Z=D.mainVideoEntity;x=D.channelEntity;g.Xh(T,5);var J=L3(Z.thumbnail),L=L3(x.avatar);return g.q(T,XZ(J.concat(L)),7);case 7:g.BI(T,0);break;case 5:w=g.IJ(T),w instanceof Error&&w.message==="Failed to fetch"&&GX(w.message),g.yq(T)}})},MX_=function(k,n,t,d){var G,R,O,D,Z,x,w,T,J,L,b,E,B;
return g.H(function(h){switch(h.B){case 1:t||(t=Date.now().toString());R=(G=n.channel)==null?void 0:G.offlineChannelData;O={id:g.S5(n.videoId,"ytMainChannelEntity"),channelId:R.channelId,title:R.title,avatar:R.thumbnail};D={key:g.S5(n.videoId,"mainVideoDownloadStateEntity"),playbackData:g.S5(n.videoId,"playbackData"),addedTimestampMillis:t,videoDownloadContextEntity:g.S5(n.videoId,"videoDownloadContextEntity")};Z={key:g.S5(n.videoId,"videoPlaybackPositionEntity"),videoId:n.videoId,lastPlaybackPositionSeconds:"0"};
k.q3.G("html5_offline_playback_position_sync")&&(x={playbackPosition:Z.key});w=g.S5(n.videoId,"mainVideoEntity");T={key:w,videoId:n.videoId,title:n.title,thumbnail:n.thumbnail,localizedStrings:{viewCount:n.shortViewCountText},userState:x,lengthSeconds:n.lengthSeconds?Number(n.lengthSeconds):void 0,publishedTimestampMillis:n.publishedTimestamp?(Number(n.publishedTimestamp)*1E3).toString():void 0,formattedDescription:n.description,owner:O.id,downloadState:D.key};if(!k.q3.G("woffle_enable_main_downloads_library")||
!d){h.DH(2);break}return g.q(h,HS5(k.B,[w]),3);case 3:if(b=h.T)J=b.mainDownloadsLibraryEntity,L=b.mainDownloadsListEntity;case 2:return B=bS_,E={key:g.S5(n.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.am(D,B,E),g.q(h,Ce(k.B,{mode:"readwrite",PC:!0},function(W){var e=vD(W,O,"ytMainChannelEntity"),P=vD(W,D,"mainVideoDownloadStateEntity"),Q=vD(W,T,"mainVideoEntity");e=[e,P,Q];k.q3.G("html5_offline_playback_position_sync")&&(P=vD(W,Z,"videoPlaybackPositionEntity"),
e.push(P));J&&(P=vD(W,J,"mainDownloadsLibraryEntity"),e.push(P));L&&(P=vD(W,L,"mainDownloadsListEntity"),e.push(P));E&&(W=vD(W,E,"downloadStatusEntity"),e.push(W));return g.Bh.all(e)}),4);
case 4:return h.return({mainVideoEntity:T,channelEntity:O})}})},gbK=function(k,n,t){this.B=k;
this.q3=n;this.C=t},lEm=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p;
return g.H(function(X){switch(X.B){case 1:return t=$P(n),d=[],g.q(X,Nq.getInstance(),2);case 2:G=X.T;if(!G){X.DH(3);break}return g.q(X,G.get("sdois"),4);case 4:return R=X.T,g.q(X,(D=G)==null?void 0:D.get("lmqf"),5);case 5:O=X.T;case 3:g.Xh(X,6);if(R===void 0)throw Error("prefStorage or opt-in state is undefined");Z=[];if(R){X.DH(8);break}return g.q(X,e2f(k.B),9);case 9:Z=X.T,Z.reverse();case 8:if(!Z.length){X.DH(10);break}x=g.y(Z);w=x.next();case 11:if(w.done){X.DH(10);break}T=w.value;if(!T){X.DH(12);
break}J=g.pC(T).entityId;return g.q(X,B6(k.B,J),14);case 14:return L=X.T,L.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.q(X,EF(J,k.B,{entityKey:T,actionType:n.actionType},k.C,L),12);case 12:w=x.next();X.DH(11);break;case 10:return g.q(X,lxD(R,(b=O)!=null?b:"SD"),16);case 16:return E=X.T,g.q(X,ABm(E),17);case 17:B=qGK(E);if(!k.q3.G("woffle_enable_main_downloads_library")){X.DH(18);break}if(R){X.DH(19);break}return g.q(X,PL4(k.B,g.HX),19);case 19:return g.q(X,FGf(k.B,[g.HX]),18);
case 18:if((h=B)==null?0:h.length)for(W=g.y(B),e=W.next();!e.done;e=W.next())if(Q=P=e.value,k$=Q.actionType,M=Q.entityKey,Gb=Q.actionMetadata,k$&&M&&Gb&&!g.z(Gb,CUC)){k$==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Gb.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Y$=g.z(P.actionMetadata,C3))Y$.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",P.actionMetadata=Object.assign({},P.actionMetadata,{mainVideoEntityActionMetadata:Y$});d.push(P)}g.BI(X,7);break;
case 6:return S=g.IJ(X),a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.b4&&S.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),X.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,a,p));case 7:return X.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,d))}})},pH4=function(){uw.apply(this,arguments);
this.K="mainVideoEntity"},So_=function(k,n,t){n=n===void 0?43200:n;
t=t===void 0?!0:t;var d=d===void 0?!1:d;var G,R,O;return g.H(function(D){switch(D.B){case 1:if(!k.L.VF())return D.return([]);G=[];g.Xh(D,2);return g.q(D,gs_(n,t,d),4);case 4:G=D.T;g.BI(D,3);break;case 2:R=g.IJ(D),R instanceof Error&&R.message==="No data"||R instanceof Error&&R.message==="Empty response body"&&GX(R.message);case 3:return O=VXC(k,G,t,"mainPlaylistEntity"),D.return(O)}})},kQ9=function(k,n,t,d){d=d===void 0?!1:d;
var G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W;return g.H(function(e){switch(e.B){case 1:return G=[],g.q(e,CL7(),2);case 2:return(R=e.T)||d?g.q(e,pjW(n,t),3):e.return([]);case 3:O=e.T;if((D=O)==null||!D.length)return e.return([]);Z={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};x=g.y(O);w=x.next();case 4:if(w.done){e.DH(6);break}J=T=w.value;L=J.actionType;b=J.entityKey;E=J.actionMetadata;if(!(L&&b&&E)||g.z(E,CUC)){e.DH(5);break}L==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(E.offlineLoggingData=
Z);B=g.pC(b);h=B.entityId;return g.q(e,Ma(k,[h],"mainVideoEntity",L,E),8);case 8:W=e.T,G=G.concat(W);case 5:w=x.next();e.DH(4);break;case 6:return e.return(G)}})},n0f=function(k,n){this.B=k;
this.C=n},dd_=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h;
return g.H(function(W){switch(W.B){case 1:return t=$P(n),d=g.pC(n.entityKey),G=d.entityId,R=[],g.Xh(W,2),g.q(W,tuG(k,G),4);case 4:R=W.T;if((O=R)==null||!O.length){W.DH(5);break}return g.q(W,fxi(k.B,n.entityKey),5);case 5:g.BI(W,3);break;case 2:return D=g.IJ(W),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.b4&&D.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
W.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Z,x));case 3:return w=[],g.q(W,mw4(k.B,"musicTrack",R),7);case 7:R=W.T;if(R.length)for(T=g.y(R),J=T.next();!J.done;J=T.next())if(L=J.value,b=L.offlineVideoData,E=void 0,(E=b)==null?0:E.videoId)B=void 0,h=Number(((B=n.actionMetadata)==null?void 0:B.priority)||0)+1,w.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b.videoId,"musicTrack",h,lw,AO(n,b,G)));return W.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,w))}})},
GQm=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk,DG,yD,I,V,A,F,r,nw,RJ,Ot,c,Et,oJ,D7,PI,pw,zm,ke,MI,Cl,zP,bl,Mz,T7,C9;
return g.H(function(aW){switch(aW.B){case 1:return t=$P(n),d=n.entityKey,G=g.pC(d).entityId,R=[],O=!1,G==="!*$_ALL_ENTITIES_!*$"?(O=!0,g.q(aW,Sg(k.B,"musicAlbumRelease"),5)):g.q(aW,pe(k.B,d,"musicAlbumRelease"),4);case 4:(D=aW.T)&&R.push(D);aW.DH(3);break;case 5:R=aW.T;case 3:if((Z=R)==null||!Z.length)return aW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));if(O){x=[];w=g.y(R);for(T=w.next();!T.done;T=w.next())J=T.value,L=g.pC(J.id).entityId,x.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
L,"musicAlbumRelease",0,lw));return aW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,x))}b=[];E=R[0];B=void 0;if(!E.downloadMetadata){aW.DH(6);break}return g.q(aW,pe(k.B,E.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:h=aW.T,B=Number((e=(W=h)==null?void 0:W.addedTimestampMillis)!=null?e:"0")/1E3;case 6:return g.Xh(aW,8),g.q(aW,tuG(k,G,(P=B)==null?void 0:P.toString()),10);case 10:b=aW.T;g.BI(aW,9);break;case 8:Q=g.IJ(aW);if(!(Q instanceof Error&&Q.message===
"No data")){if(Q instanceof Error&&Q.message==="Empty response body")GX(Q.message);else return k$="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.b4&&Q.type==="QUOTA_EXCEEDED"&&(k$="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),aW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,k$,M));aW.DH(9);break}return g.q(aW,hO(G,"musicAlbumRelease",
k.B,n,k.C),9);case 9:Gb=[];Y$=new Map;if((S=b)==null?0:S.length)for(a=g.y(b),p=a.next();!p.done;p=a.next())X=p.value,K=X.offlineVideoData,zb=void 0,((zb=K)==null?0:zb.videoId)&&Y$.set(K.videoId,K);hk=new Map;m_=[];if((Vq=E)==null?0:(tk=Vq.tracks)==null?0:tk.length)for(DG=g.y(E.tracks),yD=DG.next();!yD.done;yD=DG.next())if(I=yD.value,V=g.pC(I).entityId)Y$.has(V)?(hk.set(V,Y$.get(V)),Y$.delete(V)):m_.push(V);F=Number(((A=n.actionMetadata)==null?void 0:A.priority)||0)+1;r=g.y(Y$.entries());for(nw=r.next();!nw.done;nw=
r.next())RJ=nw.value,Ot=g.y(RJ),c=Ot.next().value,Et=Ot.next().value,oJ=c,D7=Et,Gb.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",oJ,"musicTrack",F,lw,AO(n,D7)));PI=g.y(hk.entries());for(pw=PI.next();!pw.done;pw=PI.next())zm=pw.value,ke=g.y(zm),MI=ke.next().value,Cl=ke.next().value,zP=MI,bl=Cl,Gb.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",zP,"musicTrack",F,lw,AO(n,bl)));Mz=g.y(m_);for(T7=Mz.next();!T7.done;T7=Mz.next())C9=T7.value,Gb.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",C9,
"musicTrack",0,lw));return aW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,Gb))}})},Rlk=function(k,n){var t,d;
return g.H(function(G){switch(G.B){case 1:return t=$P(n),g.Xh(G,2),d=g.pC(n.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.q(G,V2(k.B,n,k.C),5):g.q(G,hO(d,"musicAlbumRelease",k.B,n,k.C),6);case 6:return g.q(G,Q8f(k.B,n.entityKey),5);case 5:g.BI(G,3);break;case 2:return g.IJ(G),G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},tuG=function(k,n,t){var d,G,R;
return g.H(function(O){switch(O.B){case 1:return g.q(O,uJ4([n]),2);case 2:return d=O.T,g.q(O,OJC(k,d[0],t),3);case 3:return G=O.T,R=L3(G.thumbnailDetails),g.q(O,XZ(R),4);case 4:return O.return(d[0].videos)}})},OJC=function(k,n,t){var d,G,R,O,D,Z,x,w,T,J,L,b,E,B;
return g.H(function(h){if(h.B==1){d=n.additionalMetadadatas;G=void 0;if(d&&d.length>0)for(R=g.y(d),O=R.next();!O.done;O=R.next())if(D=O.value,D.offlineMusicPlaylistData){G=D.offlineMusicPlaylistData;break}Z=n.playlistId;x=z25(n);w=x.Sn;T=x.rR;J=t?(Number(t)*1E3).toString():Date.now().toString();L=n.lastModifiedTimestamp?(Number(n.lastModifiedTimestamp)*1E3).toString():"0";b={id:g.S5(Z,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:T,lastModifiedTimestampMillis:L,addedTimestampMillis:J,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};E={id:g.S5(Z,"musicAlbumRelease"),title:n.title,audioPlaylistId:Z,trackCount:n.totalVideoCount,tracks:w,downloadMetadata:b.id};G&&(E.thumbnailDetails=(B=G.albumHqThumbnail)!=null?B:G.albumArtistThumbnail,E.artistDisplayName=G.albumArtistDisplayName,E.releaseDate=G.albumReleaseDate,E.contentRating={explicitType:G.albumReleaseExplicitType},E.releaseType=G.albumReleaseType);return g.q(h,Ce(k.B,{mode:"readwrite",PC:!0},function(W){var e=vD(W,E,"musicAlbumRelease");
W=vD(W,b,"musicAlbumReleaseDownloadMetadataEntity");return g.Bh.all([e,W])}),2)}return h.return(E)})},YP5=function(k,n){this.B=k;
this.C=n},Dd_=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h;
return g.H(function(W){switch(W.B){case 1:return t=$P(n),d=g.pC(n.entityKey),G=d.entityId,R=[],g.Xh(W,2),g.q(W,o0k(k,G),4);case 4:R=W.T;if((O=R)==null||!O.length){W.DH(5);break}return g.q(W,fxi(k.B,n.entityKey),5);case 5:g.BI(W,3);break;case 2:return D=g.IJ(W),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.b4&&D.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
W.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Z,x));case 3:return w=[],g.q(W,mw4(k.B,"musicTrack",R),7);case 7:R=W.T;if(R.length)for(T=g.y(R),J=T.next();!J.done;J=T.next())if(L=J.value,b=L.offlineVideoData,E=void 0,(E=b)==null?0:E.videoId)B=void 0,h=Number(((B=n.actionMetadata)==null?void 0:B.priority)||0)+1,w.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b.videoId,"musicTrack",h,p3,AO(n,b,G)));return W.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,w))}})},
$dC=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk,DG,yD,I,V,A,F,r,nw,RJ,Ot,c,Et,oJ,D7,PI,pw,zm,ke,MI,Cl,zP,bl,Mz,T7,C9,aW,lq,Ud,iX,FP,mv,PG,up,MQ,VT,dD,p9;
return g.H(function(oW){switch(oW.B){case 1:return t=$P(n),d=n.entityKey,G=g.pC(d).entityId,R=[],O=!1,G==="!*$_ALL_ENTITIES_!*$"?(O=!0,g.q(oW,Sg(k.B,"musicPlaylist"),5)):g.q(oW,pe(k.B,d,"musicPlaylist"),4);case 4:(D=oW.T)&&R.push(D);oW.DH(3);break;case 5:R=oW.T;case 3:if((Z=R)==null||!Z.length)return oW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));x=g.z(n.actionMetadata,axD);T=(w=x)==null?void 0:w.autoSync;J=[];b=L=!0;E=!1;B=void 0;if(!O&&T===!1){oW.DH(6);break}g.Xh(oW,7);return g.q(oW,
SGG(0,!!T,!0,R),9);case 9:J=oW.T;g.BI(oW,8);break;case 7:h=g.IJ(oW);if(!(h instanceof Error&&h.message==="No data")){h instanceof Error&&h.message==="Empty response body"&&GX(h.message);oW.DH(8);break}return G==="!*$_ALL_ENTITIES_!*$"?g.q(oW,V2(k.B,n,k.C),8):g.q(oW,hO(G,"musicPlaylist",k.B,n,k.C),8);case 8:if(!J.length||!O&&J[0].playlistId!==G)return oW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));case 6:if(O){W=[];e=g.y(J);for(P=e.next();!P.done;P=e.next())Q=P.value,Q.upToDate||
T&&!Q.shouldAutoSyncMetadata||!Q.playlistId||(k$={autoSync:T},W.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q.playlistId,"musicPlaylist",0,p3,{musicPlaylistEntityActionMetadata:k$})));return oW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,W))}J.length&&(M=J[0],E=!!M.upToDate,T&&(L=(Gb=M.shouldAutoSyncMetadata)!=null?Gb:!0,b=(Y$=M.shouldAutoSyncVideos)!=null?Y$:!0,M.checkInSeconds&&(B=M.checkInSeconds)));if(E||!L)return oW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));S=[];a=R[0];p=void 0;if(!a.downloadMetadata){oW.DH(15);break}return g.q(oW,pe(k.B,a.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:X=oW.T,p=Number((zb=(K=X)==null?void 0:K.addedTimestampMillis)!=null?zb:"0")/1E3;case 15:return g.Xh(oW,17),g.q(oW,o0k(k,G,(hk=p)==null?void 0:hk.toString(),B),19);case 19:S=oW.T;g.BI(oW,18);break;case 17:m_=g.IJ(oW);if(!(m_ instanceof Error&&m_.message==="No data")){if(m_ instanceof Error&&m_.message==="Empty response body")GX(m_.message);else return Vq=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",tk="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m_ instanceof g.b4&&m_.type==="QUOTA_EXCEEDED"&&(Vq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",tk="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),oW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Vq,tk));oW.DH(18);break}return g.q(oW,hO(G,"musicPlaylist",k.B,n,k.C),18);case 18:if(!b)return oW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));DG=[];yD=new Map;if((I=S)==null?0:I.length)for(V=g.y(S),A=V.next();!A.done;A=V.next())F=A.value,r=F.offlineVideoData,nw=void 0,((nw=r)==null?0:nw.videoId)&&yD.set(r.videoId,r);RJ=new Map;Ot=[];if((c=a)==null?0:(Et=c.tracks)==null?0:Et.length)for(oJ=g.y(a.tracks),D7=oJ.next();!D7.done;D7=oJ.next())if(PI=D7.value,pw=g.pC(PI).entityId)yD.has(pw)?(RJ.set(pw,yD.get(pw)),yD.delete(pw)):Ot.push(pw);ke=Number(((zm=n.actionMetadata)==null?void 0:zm.priority)||0)+1;MI=g.y(yD.entries());for(Cl=MI.next();!Cl.done;Cl=
MI.next())zP=Cl.value,bl=g.y(zP),Mz=bl.next().value,T7=bl.next().value,C9=Mz,aW=T7,DG.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C9,"musicTrack",ke,p3,AO(n,aW)));lq=g.y(RJ.entries());for(Ud=lq.next();!Ud.done;Ud=lq.next())iX=Ud.value,FP=g.y(iX),mv=FP.next().value,PG=FP.next().value,up=mv,MQ=PG,DG.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",up,"musicTrack",ke,p3,AO(n,MQ)));VT=g.y(Ot);for(dD=VT.next();!dD.done;dD=VT.next())p9=dD.value,DG.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
p9,"musicTrack",0,p3));return oW.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,DG))}})},ZJ7=function(k,n){var t,d;
return g.H(function(G){switch(G.B){case 1:return t=$P(n),g.Xh(G,2),d=g.pC(n.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.q(G,V2(k.B,n,k.C),5):g.q(G,hO(d,"musicPlaylist",k.B,n,k.C),6);case 6:return g.q(G,Q8f(k.B,n.entityKey),5);case 5:g.BI(G,3);break;case 2:return g.IJ(G),G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},o0k=function(k,n,t,d){var G,R,O;
return g.H(function(D){switch(D.B){case 1:return g.q(D,uJ4([n]),2);case 2:return G=D.T,g.q(D,xdi(k,G[0],t,d),3);case 3:return R=D.T,O=L3(R.thumbnailDetails),g.q(D,XZ(O),4);case 4:return D.return(G[0].videos)}})},xdi=function(k,n,t,d){var G,R,O,D,Z,x,w,T,J;
return g.H(function(L){return L.B==1?(G=n.playlistId,R=z25(n),O=R.Sn,D=R.rR,Z=t?(Number(t)*1E3).toString():Date.now().toString(),x=n.lastModifiedTimestamp?(Number(n.lastModifiedTimestamp)*1E3).toString():"0",w={id:g.S5(G,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:x,addedTimestampMillis:Z,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},T={id:g.S5(G,"musicPlaylist"),title:n.title,playlistId:G,thumbnailDetails:n.thumbnail,visibility:w$m(n),trackCount:n.totalVideoCount,
tracks:O,downloadMetadata:w.id},d&&(((J=T)==null?0:J.entityMetadata)?T.entityMetadata.nextAutoRefreshIntervalSeconds=String(d):T&&(T.entityMetadata={nextAutoRefreshIntervalSeconds:String(d)})),g.q(L,Ce(k.B,{mode:"readwrite",PC:!0},function(b){var E=vD(b,T,"musicPlaylist");b=vD(b,w,"musicPlaylistDownloadMetadataEntity");return g.Bh.all([E,b])}),2)):L.return(T)})},w$m=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Ty9=function(k,n){this.B=k;
this.C=n},bJD=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b;
return g.H(function(E){switch(E.B){case 1:return t=$P(n),d=g.pC(n.entityKey),G=d.entityId,R=g.z(n.actionMetadata,iJ5),g.Xh(E,2),g.q(E,J8D(k,G,void 0,(O=R)==null?void 0:O.track,(D=R)==null?void 0:D.albumRelease),4);case 4:if((Z=R)==null?0:Z.playlistId){E.DH(5);break}return g.q(E,fxi(k.B,n.entityKey),5);case 5:g.BI(E,3);break;case 2:return x=g.IJ(E),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.b4&&x.type==="QUOTA_EXCEEDED"&&
(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),E.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,w,T));case 3:L=Number(((J=n.actionMetadata)==null?void 0:J.priority)||0)+1;var B=(B=g.z(n.actionMetadata,iJ5))?{playbackDataActionMetadata:{maximumDownloadQuality:B.maximumDownloadQuality}}:void 0;b=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G,"playbackData",L,LJ5,B);return E.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t,[b]))}})},md9=function(k,n){var t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B;
return g.H(function(h){switch(h.B){case 1:return t=$P(n),d=g.pC(n.entityKey),G=d.entityId,g.q(h,pe(k.B,n.entityKey,"musicTrack"),2);case 2:R=h.T;if(!R){O=void 0;h.DH(3);break}return g.q(h,pe(k.B,R.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:O=h.T;case 3:D=O;if(!R||!D)return h.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));x=g.z(n.actionMetadata,iJ5);g.Xh(h,5);return g.q(h,J8D(k,G,D.addedTimestampMillis,(w=x)==null?void 0:w.track,(T=x)==null?void 0:T.albumRelease),
7);case 7:L=Number(((J=n.actionMetadata)==null?void 0:J.priority)||0)+1;Z=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G,"playbackData",L,LJ5);g.BI(h,6);break;case 5:b=g.IJ(h);if(!(b instanceof Error&&b.message==="No data")){if(b instanceof Error&&b.message==="Empty response body")GX(b.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.b4&&b.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,E,B));h.DH(6);break}return g.q(h,I4(G,k.B,n,k.C),6);case 6:return h.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,Z?[Z]:void 0))}})},y89=function(k,n){var t,d;
return g.H(function(G){switch(G.B){case 1:return t=$P(n),g.Xh(G,2),d=g.pC(n.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.q(G,V2(k.B,n,k.C),5):g.q(G,I4(d,k.B,n,k.C),6);case 6:return g.q(G,Q8f(k.B,n.entityKey),5);case 5:g.BI(G,3);break;case 2:return g.IJ(G),G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new FZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},J8D=function(k,n,t,d,G){var R,O,D,Z,x,w;
return g.H(function(T){switch(T.B){case 1:if(R=d){T.DH(2);break}return g.q(T,vsD([n]),3);case 3:O=T.T,D=O[0],R=Nsm(D);case 2:return g.q(T,srC(k,R,n,G,t),4);case 4:Z=T.T;x=Z.musicTrackEntity;w=Z.XS;var J=L3(x.thumbnailDetails),L=[];w&&(L=L3(w.thumbnailDetails));return g.q(T,XZ(J.concat(L)),0)}})},srC=function(k,n,t,d,G){var R;
return g.H(function(O){return O.B==1?(G||(G=Date.now().toString()),R={id:g.S5(t,"musicTrackDownloadMetadataEntity"),playbackData:g.S5(t,"playbackData"),addedTimestampMillis:G,videoDownloadContextEntity:g.S5(t,"videoDownloadContextEntity")},d&&(n.albumRelease=d.id),g.q(O,Ce(k.B,{mode:"readwrite",PC:!0},function(D){var Z=[],x=vD(D,R,"musicTrackDownloadMetadataEntity");Z.push(x);x=vD(D,n,"musicTrack");Z.push(x);d&&(D=vD(D,d,"musicAlbumRelease"),Z.push(D));return g.Bh.all(Z)}),2)):O.B!=3?g.q(O,TX(t,"musicTrackDownloadMetadataEntity",
k.B,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):O.return({musicTrackEntity:n,
XS:d})})},Sr=function(){uw.apply(this,arguments);
this.K="musicTrack"},X$C=function(k,n,t){n=n===void 0?43200:n;
t=t===void 0?!0:t;var d=d===void 0?!1:d;var G,R;return g.H(function(O){switch(O.B){case 1:if(!k.L.VF())return O.return([]);G=[];g.Xh(O,2);return g.q(O,SGG(n,t,d),4);case 4:G=O.T;g.BI(O,3);break;case 2:g.IJ(O);case 3:return R=VXC(k,G,t,"musicPlaylist"),O.return(R)}})},E0i=function(){g.Jz.apply(this,arguments);
var k=this;this.events=new g.ct(this);this.q3=this.player.V();this.fq={F0_:function(){return k.B},
VM:function(){return k.VM()},
Mt:function(n){return k.Mt(n)}}},Ud5=function(k){var n;
k=g.z((n=k.getWatchNextResponse())==null?void 0:n.currentVideoEndpoint,g.tb);if(k==null?0:k.playlistId)var t=k.playlistId;return t},Byk=function(k,n){var t,d,G,R;
return g.H(function(O){if(O.B==1){t=n.clientPlaybackNonce;d={cpn:t,offlineSourceVisualElement:g.Im(n.FX||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};n.T&&(d.videoFmt=Number(n.T.itag));n.S&&(d.audioFmt=Number(n.S.itag));if((G=Ud5(n))&&n.videoId){var D=n.videoId;D=G!=="PPSV"?Promise.resolve(!1):k.B.HM(D);O=g.q(O,D,3)}else O=O.DH(2);return O}O.B!=2&&(R=O.T)&&(d.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");k.T=t;g.ZH("offlinePlaybackStarted",d);g.yq(O)})};
g.HN.prototype.mq=g.$$(51,function(k){return this.app.mq(k)});
g.Lr.prototype.mq=g.$$(50,function(k){return g.l2q(this,9,k)});
g.m(rp,jg);g.Z7.Object.defineProperties(rp.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.B.entityMetadata},
set:function(k){this.B.entityMetadata=k}}});
g.m(mQ_,rp);mQ_.prototype.T=function(){return[]};
g.m(y7k,rp);y7k.prototype.T=function(){return[]};
g.m(sNW,rp);sNW.prototype.T=function(){return[]};
g.m(Xc5,rp);Xc5.prototype.T=function(){return[]};
g.m(E2K,rp);E2K.prototype.T=function(){var k=[];this.B.alternateChannel&&k.push(this.B.alternateChannel);this.B.alternateChannelList&&k.push.apply(k,g.U(this.B.alternateChannelList));this.B.oneofChannelEntity&&k.push(this.B.oneofChannelEntity);return[].concat(g.U(new Set(k)))};
g.m(UQ7,rp);UQ7.prototype.T=function(){var k=[];this.B.entryCollection&&k.push(this.B.entryCollection);return[].concat(g.U(new Set(k)))};
g.m(BR7,jg);BR7.prototype.T=function(){var k=[];this.B.video&&k.push(this.B.video);return[].concat(g.U(new Set(k)))};
g.m(Ick,rp);Ick.prototype.T=function(){var k=[];this.B.parentPlaylist&&k.push(this.B.parentPlaylist);if(this.B.entries)for(var n=g.y(this.B.entries),t=n.next();!t.done;t=n.next())k.push.apply(k,g.U((new BR7(t.value)).T()));return[].concat(g.U(new Set(k)))};
g.m(hg_,rp);hg_.prototype.T=function(){var k=[];this.B.descriptionEntity&&k.push(this.B.descriptionEntity);this.B.creators&&k.push.apply(k,g.U(this.B.creators));this.B.theBiggestFan&&k.push(this.B.theBiggestFan);return[].concat(g.U(new Set(k)))};
g.m(Vo_,rp);Vo_.prototype.T=function(){return[]};
g.m(A7f,rp);A7f.prototype.T=function(){return[]};
g.m(WyD,rp);WyD.prototype.T=function(){return[]};
g.m(qwO,rp);qwO.prototype.T=function(){return[]};
g.m(egG,rp);egG.prototype.T=function(){return[]};
g.m(Hsi,rp);Hsi.prototype.T=function(){return[]};
g.m(Fyi,rp);Fyi.prototype.T=function(){return[]};
g.m(PpG,rp);PpG.prototype.T=function(){return[]};
g.m(jND,rp);jND.prototype.T=function(){return[]};
g.m(r7i,rp);r7i.prototype.T=function(){var k=[];this.B.downloadsList&&k.push(this.B.downloadsList);this.B.smartDownloadsList&&k.push(this.B.smartDownloadsList);this.B.recommendedDownloadsList&&k.push(this.B.recommendedDownloadsList);this.B.refresh&&k.push(this.B.refresh);return[].concat(g.U(new Set(k)))};
g.m(c74,jg);c74.prototype.T=function(){var k=[];this.B.video&&k.push(this.B.video);this.B.playlist&&k.push(this.B.playlist);this.B.videoItem&&k.push(this.B.videoItem);this.B.playlistItem&&k.push(this.B.playlistItem);return[].concat(g.U(new Set(k)))};
g.m(NRG,rp);NRG.prototype.T=function(){var k=[];this.B.refresh&&k.push(this.B.refresh);if(this.B.downloads)for(var n=g.y(this.B.downloads),t=n.next();!t.done;t=n.next())k.push.apply(k,g.U((new c74(t.value)).T()));return[].concat(g.U(new Set(k)))};
g.m(fcO,rp);fcO.prototype.T=function(){var k=[];this.B.localImageEntities&&k.push.apply(k,g.U(this.B.localImageEntities));return[].concat(g.U(new Set(k)))};
g.m(QN5,rp);QN5.prototype.T=function(){var k=[];this.B.playbackData&&k.push(this.B.playbackData);this.B.localImageEntities&&k.push.apply(k,g.U(this.B.localImageEntities));this.B.videoDownloadContextEntity&&k.push(this.B.videoDownloadContextEntity);return[].concat(g.U(new Set(k)))};
g.m(zgC,rp);zgC.prototype.T=function(){return[]};
g.m(ac5,rp);ac5.prototype.T=function(){var k=[];this.B.fakeChildren&&k.push.apply(k,g.U(this.B.fakeChildren));return[].concat(g.U(new Set(k)))};
g.m(Ky4,rp);Ky4.prototype.T=function(){var k=[];this.B.video&&k.push(this.B.video);this.B.playbackData&&k.push(this.B.playbackData);this.B.offlineVideoPolicy&&k.push(this.B.offlineVideoPolicy);return[].concat(g.U(new Set(k)))};
g.m(v25,rp);v25.prototype.T=function(){return[]};
g.m(u14,rp);u14.prototype.T=function(){var k=[];this.B.channelOwner&&k.push(this.B.channelOwner);this.B.videos&&k.push.apply(k,g.U(this.B.videos));this.B.collaboratorChannels&&k.push.apply(k,g.U(this.B.collaboratorChannels));this.B.downloadState&&k.push(this.B.downloadState);this.B.refresh&&k.push(this.B.refresh);return[].concat(g.U(new Set(k)))};
g.m(Mo5,rp);Mo5.prototype.T=function(){var k=[];this.B.video&&k.push(this.B.video);this.B.channelContributor&&k.push(this.B.channelContributor);return[].concat(g.U(new Set(k)))};
g.m(g2D,jg);g2D.prototype.T=function(){var k=[];this.B.localImageEntities&&k.push.apply(k,g.U(this.B.localImageEntities));this.B.videoDownloadContextEntity&&k.push(this.B.videoDownloadContextEntity);return[].concat(g.U(new Set(k)))};
g.m(Cp5,jg);Cp5.prototype.T=function(){var k=[];this.B.recommendedVideoMetadata&&k.push.apply(k,g.U((new g2D(this.B.recommendedVideoMetadata)).T()));return[].concat(g.U(new Set(k)))};
g.m(lc4,jg);lc4.prototype.T=function(){var k=[];this.B.playbackPosition&&k.push(this.B.playbackPosition);return[].concat(g.U(new Set(k)))};
g.m(pc4,rp);pc4.prototype.T=function(){var k=[];this.B.owner&&k.push(this.B.owner);this.B.downloadState&&k.push(this.B.downloadState);this.B.userState&&k.push.apply(k,g.U((new lc4(this.B.userState)).T()));this.B.additionalMetadata&&k.push.apply(k,g.U((new Cp5(this.B.additionalMetadata)).T()));return[].concat(g.U(new Set(k)))};
g.m(Swi,rp);Swi.prototype.T=function(){var k=[];this.B.userChannelDetails&&k.push(this.B.userChannelDetails);return[].concat(g.U(new Set(k)))};
g.m(k$m,rp);k$m.prototype.T=function(){var k=[];this.B.channelOwner&&k.push(this.B.channelOwner);this.B.playbackPosition&&k.push(this.B.playbackPosition);this.B.localImageEntities&&k.push.apply(k,g.U(this.B.localImageEntities));this.B.downloadStatus&&k.push(this.B.downloadStatus);return[].concat(g.U(new Set(k)))};
g.m(njG,rp);njG.prototype.T=function(){return[]};
g.m(t35,rp);t35.prototype.T=function(){return[]};
g.m(d1C,rp);d1C.prototype.T=function(){return[]};
g.m(G$D,rp);G$D.prototype.T=function(){return[]};
g.m(RW4,rp);RW4.prototype.T=function(){return[]};
g.m(OID,rp);OID.prototype.T=function(){return[]};
g.m(YED,rp);YED.prototype.T=function(){return[]};
g.m(oj9,rp);oj9.prototype.T=function(){return[]};
g.m(D1O,rp);D1O.prototype.T=function(){return[]};
g.m($15,rp);$15.prototype.T=function(){return[]};
g.m(ZIW,rp);ZIW.prototype.T=function(){return[]};
g.m(x1K,rp);x1K.prototype.T=function(){var k=[];this.B.trackDownloadMetadatas&&k.push.apply(k,g.U(this.B.trackDownloadMetadatas));return[].concat(g.U(new Set(k)))};
g.m(wM_,rp);
wM_.prototype.T=function(){var k=[];this.B.downloadedTracks&&k.push.apply(k,g.U(this.B.downloadedTracks));this.B.smartDownloadedTracks&&k.push.apply(k,g.U(this.B.smartDownloadedTracks));this.B.downloadedEpisodes&&k.push.apply(k,g.U(this.B.downloadedEpisodes));this.B.downloadedAlbumReleases&&k.push.apply(k,g.U(this.B.downloadedAlbumReleases));this.B.smartDownloadedAlbumReleases&&k.push.apply(k,g.U(this.B.smartDownloadedAlbumReleases));this.B.downloadedPlaylists&&k.push.apply(k,g.U(this.B.downloadedPlaylists));this.B.smartDownloadedPlaylists&&
k.push.apply(k,g.U(this.B.smartDownloadedPlaylists));this.B.metadataOnlyTracks&&k.push.apply(k,g.U(this.B.metadataOnlyTracks));return[].concat(g.U(new Set(k)))};
g.m(T5D,rp);T5D.prototype.T=function(){var k=[];this.B.trackDownloadMetadatas&&k.push.apply(k,g.U(this.B.trackDownloadMetadatas));return[].concat(g.U(new Set(k)))};
g.m(iIO,rp);iIO.prototype.T=function(){var k=[];this.B.playbackData&&k.push(this.B.playbackData);this.B.localImageEntities&&k.push.apply(k,g.U(this.B.localImageEntities));this.B.videoDownloadContextEntity&&k.push(this.B.videoDownloadContextEntity);return[].concat(g.U(new Set(k)))};
g.m(JJG,rp);JJG.prototype.T=function(){var k=[];this.B.musicLibraryStatusEntity&&k.push(this.B.musicLibraryStatusEntity);this.B.primaryArtists&&k.push.apply(k,g.U(this.B.primaryArtists));this.B.details&&k.push(this.B.details);this.B.userDetails&&k.push(this.B.userDetails);this.B.tracks&&k.push.apply(k,g.U(this.B.tracks));this.B.share&&k.push(this.B.share);this.B.downloadMetadata&&k.push(this.B.downloadMetadata);this.B.refresh&&k.push(this.B.refresh);return[].concat(g.U(new Set(k)))};
g.m(LpD,rp);LpD.prototype.T=function(){var k=[];this.B.albumRelease&&k.push(this.B.albumRelease);this.B.tracks&&k.push.apply(k,g.U(this.B.tracks));return[].concat(g.U(new Set(k)))};
g.m(bIK,rp);bIK.prototype.T=function(){var k=[];this.B.albumRelease&&k.push(this.B.albumRelease);return[].concat(g.U(new Set(k)))};
g.m(m1K,rp);m1K.prototype.T=function(){var k=[];this.B.details&&k.push(this.B.details);this.B.userDetails&&k.push(this.B.userDetails);return[].concat(g.U(new Set(k)))};
g.m(yJ_,rp);yJ_.prototype.T=function(){var k=[];this.B.parentArtist&&k.push(this.B.parentArtist);return[].concat(g.U(new Set(k)))};
g.m(sHi,rp);sHi.prototype.T=function(){var k=[];this.B.parentArtist&&k.push(this.B.parentArtist);return[].concat(g.U(new Set(k)))};
g.m(XMk,rp);XMk.prototype.T=function(){return[]};
g.m(EjW,rp);EjW.prototype.T=function(){return[]};
g.m(U17,jg);U17.prototype.T=function(){var k=[];this.B.creatorEntity&&k.push(this.B.creatorEntity);return[].concat(g.U(new Set(k)))};
g.m(B5_,rp);
B5_.prototype.T=function(){var k=[];this.B.tracks&&k.push.apply(k,g.U(this.B.tracks));this.B.refresh&&k.push(this.B.refresh);this.B.musicLibraryStatusEntity&&k.push(this.B.musicLibraryStatusEntity);this.B.details&&k.push(this.B.details);this.B.downloadMetadata&&k.push(this.B.downloadMetadata);this.B.sideloadMetadata&&k.push(this.B.sideloadMetadata);this.B.userDetails&&k.push(this.B.userDetails);this.B.entryCollection&&k.push(this.B.entryCollection);this.B.share&&k.push(this.B.share);this.B.podcastShowAdditionalMetadata&&k.push.apply(k,
g.U((new U17(this.B.podcastShowAdditionalMetadata)).T()));return[].concat(g.U(new Set(k)))};
g.m(I0K,rp);I0K.prototype.T=function(){return[]};
g.m(hWm,rp);
hWm.prototype.T=function(){var k=[];this.B.musicLibraryStatusEntity&&k.push(this.B.musicLibraryStatusEntity);this.B.artists&&k.push.apply(k,g.U(this.B.artists));this.B.audioModeVersion&&k.push(this.B.audioModeVersion);this.B.videoModeVersion&&k.push(this.B.videoModeVersion);this.B.userDetails&&k.push(this.B.userDetails);this.B.details&&k.push(this.B.details);this.B.albumRelease&&k.push(this.B.albumRelease);this.B.share&&k.push(this.B.share);this.B.libraryEdit&&k.push(this.B.libraryEdit);this.B.downloadMetadata&&
k.push(this.B.downloadMetadata);this.B.playbackPosition&&k.push(this.B.playbackPosition);this.B.lyrics&&k.push(this.B.lyrics);return[].concat(g.U(new Set(k)))};
g.m(V3D,rp);V3D.prototype.T=function(){var k=[];this.B.parentTrack&&k.push(this.B.parentTrack);return[].concat(g.U(new Set(k)))};
g.m(AJk,rp);AJk.prototype.T=function(){var k=[];this.B.parentTrack&&k.push(this.B.parentTrack);return[].concat(g.U(new Set(k)))};
g.m(Wpf,rp);Wpf.prototype.T=function(){return[]};
g.m(qEf,rp);qEf.prototype.T=function(){return[]};
g.m(eW9,rp);eW9.prototype.T=function(){return[]};
g.m(HI_,rp);HI_.prototype.T=function(){return[]};
g.m(Fpi,rp);Fpi.prototype.T=function(){var k=[];this.B.transfer&&k.push(this.B.transfer);this.B.adsPlaybackData&&k.push.apply(k,g.U(this.B.adsPlaybackData));this.B.drmLicense&&k.push(this.B.drmLicense);this.B.offlineVideoPolicy&&k.push(this.B.offlineVideoPolicy);this.B.videoDownloadContextEntity&&k.push(this.B.videoDownloadContextEntity);return[].concat(g.U(new Set(k)))};
g.m(PdW,rp);PdW.prototype.T=function(){return[]};
g.m(jHk,rp);jHk.prototype.T=function(){var k=[];this.B.offlineVideoStreams&&k.push.apply(k,g.U(this.B.offlineVideoStreams));this.B.captionTrack&&k.push.apply(k,g.U(this.B.captionTrack));return[].concat(g.U(new Set(k)))};
g.m(rJm,rp);rJm.prototype.T=function(){return[]};
g.m(cJW,rp);cJW.prototype.T=function(){return[]};
g.m(N55,rp);N55.prototype.T=function(){return[]};
g.m(f05,rp);f05.prototype.T=function(){return[]};
g.m(QHi,rp);QHi.prototype.T=function(){return[]};
g.m(zWG,rp);zWG.prototype.T=function(){return[]};
g.m(a09,rp);a09.prototype.T=function(){return[]};
g.m(Kpk,rp);Kpk.prototype.T=function(){return[]};
g.m(vj9,rp);vj9.prototype.T=function(){return[]};
g.m(uqO,rp);uqO.prototype.T=function(){return[]};
g.m(M3f,rp);M3f.prototype.T=function(){return[]};
g.m(gjG,rp);gjG.prototype.T=function(){return[]};
g.m(CdD,rp);CdD.prototype.T=function(){return[]};
g.m(l0i,rp);l0i.prototype.T=function(){return[]};
g.m(pMf,rp);pMf.prototype.T=function(){return[]};
g.m(SE9,rp);SE9.prototype.T=function(){return[]};
g.m(k34,rp);k34.prototype.T=function(){return[]};
g.m(nzm,rp);nzm.prototype.T=function(){return[]};
g.m(t$m,rp);t$m.prototype.T=function(){return[]};
g.m(dGO,rp);dGO.prototype.T=function(){return[]};
var ktK=["browse","music/browse","unplugged/browse"],RiK=["offline/playlist_sync_check"],KGO=["offline"],n1W=["offline/offline_video_playback_position_sync"],dfC=["offline/get_playback_data_entity"],cD;Nq.getInstance=function(){return g.H(function(k){return k.return(new Promise(function(n){g.kk().then(function(t){t?(Nq.instance||(Nq.instance=new Nq(t)),n(Nq.instance)):n(void 0)})}))})};
Nq.prototype.get=function(k){var n=this,t,d,G;return g.H(function(R){if(R.B==1)return g.q(R,Yr4(n.token),2);if(R.B!=3)return t=R.T,g.q(R,t.get("prefs",k),3);d=R.T;if(!d)return R.return();G=(0,g.AR)();return d.expirationTimestampMs<=G?R.return():R.return(d.value)})};
Nq.prototype.set=function(k,n,t){t=t===void 0?31536E3:t;var d=this,G,R,O;return g.H(function(D){if(D.B==1)return G=(0,g.AR)(),R={key:k,value:n,expirationTimestampMs:G+t*1E3},g.q(D,Yr4(d.token),2);O=D.T;return g.q(D,g.Ph(O,"prefs",R),0)})};
Nq.prototype.remove=function(k){var n=this,t;return g.H(function(d){if(d.B==1)return g.q(d,Yr4(n.token),2);t=d.T;return g.q(d,t.delete("prefs",k),0)})};
g.m(fe,g.gf);g.m(Qb,xGD);Qb.prototype.C=function(k,n){n=TiC(n);k=(new TextEncoder).encode(JSON.stringify(k));return this.B.encrypt(k,n)};
Qb.prototype.T=function(k,n){if(!(k instanceof Uint8Array))throw oz5(1);var t=new TextDecoder;n=TiC(n);k=this.B.decrypt(k,n);return JSON.parse(t.decode(k))};
var i1k={accountLinkStatusEntity:WyD,booleanEntity:sNW,buttonEntity:CdD,captionTrack:Wpf,channelHandle:mQ_,commerceAcquisitionClientPayloadEntity:pMf,commerceCartListEntity:SE9,contextNoteFeedEntityPayload:y7k,continuationTokenEntity:v25,downloadQualityPickerEntity:Fyi,downloadsPageRefreshTokenEntity:jND,downloadsPageViewConfigurationEntity:njG,downloadStatusEntity:PpG,dismissState:a09,sfvAudioItemCurrentlyPlayingEntity:f05,emojiFountainDataEntity:M3f,emojiCustomizationSetEntity:uqO,fakeChannel:E2K,
fakePlaylist:UQ7,fakePlaylistEntryCollection:Ick,fakeVideo:hg_,fakeVideoDescription:Vo_,featuredProductsEntity:D1O,flowStateEntity:A7f,iconBadgeEntity:k34,interstitialInteractionStateEntity:egG,likeButtonAnimationEntity:t35,liveChatPollStateEntity:Hsi,liveViewerLeaderboardChatEntryPointStateEntity:cJW,liveViewerLeaderboardPointsEntity:N55,liveReactionsDataEntity:gjG,logoEntity:qwO,macroMarkerEntity:d1C,mainDownloadsLibraryEntity:r7i,mainDownloadsListEntity:NRG,mainPlaylistDownloadStateEntity:fcO,
mainPlaylistEntity:u14,mainPlaylistVideoEntity:Mo5,mainVideoDownloadStateEntity:QN5,mainVideoEntity:pc4,markersEngagementPanelSyncEntity:G$D,markersVisibilityOverrideEntity:RW4,musicAlbumReleaseDetail:LpD,musicAlbumReleaseDownloadMetadataEntity:x1K,musicAlbumRelease:JJG,musicAlbumReleaseUserDetail:bIK,musicArtistDetail:yJ_,musicArtist:m1K,musicArtistUserDetail:sHi,musicDownloadsLibraryEntity:wM_,musicLibraryEdit:XMk,musicLibraryStatusEntity:EjW,musicPlaylist:B5_,musicPlaylistDownloadMetadataEntity:T5D,
musicShare:I0K,musicTrackDetail:V3D,musicTrackDownloadMetadataEntity:iIO,musicTrack:hWm,musicTrackUserDetail:AJk,offlineOrchestrationActionWrapperEntity:qEf,offlineVideoPolicy:eW9,offlineVideoStreams:HI_,offlineabilityEntity:zgC,orchestrationWebSamplingEntity:ac5,pageHeaderEntity:Kpk,pdpStateEntity:nzm,pinnedProductEntity:$15,playbackData:Fpi,playerStateEntity:OID,quantityIncrementerEntity:t$m,refresh:PdW,saveToPlaylistListEntity:QHi,settingEntity:zWG,stringEntity:Xc5,suggestedFeedbackChipStateEntity:YED,
transfer:jHk,trendingOfferEntity:ZIW,videoDownloadContextEntity:rJm,videoOverviewAsyncDataEntity:dGO,videoPlaybackPositionEntity:l0i,votingEntity:vj9,ytMainChannelEntity:Swi,youchatPendingResponseEntity:oj9,ytMainDownloadedVideoEntity:Ky4,ytMainVideoEntity:k$m};g.m(Mq,xGD);Mq.prototype.C=function(k){return k};
Mq.prototype.T=function(k){if(k instanceof Uint8Array)throw oz5(0);return k};
g.m(gp,g.N);gp.prototype.observe=function(k){var n=this;this.observers.push(k);return function(){var t=n.observers.indexOf(k);t>=0&&n.observers.splice(t,1)}};
gp.prototype.T=function(k){AH_(this,k.data)};
gp.prototype.Cf=function(){this.channel.close()};
var Fh7,WGk=new g.VQ("elementsCommand");var UF=new g.VQ("entityBatchUpdate");var bS_=new g.VQ("downloadStatusEntity");var F5k=new g.VQ("mainPlaylistEntityActionMetadata");var C3=new g.VQ("mainVideoEntityActionMetadata");var axD=new g.VQ("musicPlaylistEntityActionMetadata");var iJ5=new g.VQ("musicTrackEntityActionMetadata");var CUC=new g.VQ("localImageEntityActionMetadata");var P6=new g.VQ("playbackDataActionMetadata");var qS9=new g.VQ("transferEntityActionMetadata");var JKD=new g.VQ("videoPlaybackPositionEntityActionMetadata");var C75;new g.Bo;new g.Bo;nsm.prototype.request=function(k,n,t){n=n===void 0?{}:n;return this.locks.request(k,n,function(d){return t(d)})};var dn=g.Qq.caches,tO,OS9;n3.prototype.open=function(k){return dn.open(Gg5(k))};
n3.prototype.has=function(k){return dn.has(Gg5(k))};
n3.prototype.delete=function(k){return dn.delete(Gg5(k))};
n3.prototype.match=function(k,n){var t=this,d,G,R,O,D,Z;return g.H(function(x){switch(x.B){case 1:return g.q(x,t.keys(),2);case 2:d=x.T,G=g.y(d),R=G.next();case 3:if(R.done){x.DH(5);break}O=R.value;return g.q(x,t.open(O),6);case 6:return D=x.T,g.q(x,D.match(k,n),7);case 7:if(Z=x.T)return x.return(Z);R=G.next();x.DH(3);break;case 5:return x.return()}})};
g.m(dwO,n3);dwO.prototype.keys=function(){var k,n,t,d,G,R,O,D,Z;return g.H(function(x){if(x.B==1)return k=[],n=g.CP("CacheStorage keys"),g.q(x,dn.keys(),2);t=x.T;d=g.y(t);for(G=d.next();!G.done;G=d.next()){R=G.value;var w=R.indexOf(":");O=w===-1?{W9:R}:{W9:R.substring(0,w),datasyncId:R.substring(w+1)};D=O.W9;Z=O.datasyncId;Z===n&&k.push(D)}return x.return(k)})};g.m(R4,g.N);R4.prototype.C=function(k){this.api.A8("onOfflineOperationFailure",k.data)};
R4.prototype.S=function(k){this.api.publish("offlinetransferpause",k.data)};
R4.prototype.Cf=function(){var k;(k=this.B)==null||k.close();var n;(n=this.T)==null||n.close()};DwK.prototype.rV=function(){this.B&&YP(this)};
DwK.prototype.B_=function(){this.T&&this.T.resolve();this.C=this.B=!1;this.K()};var M4_=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var h2_="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var cB7="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.m(YSm,er);YSm.prototype.T=function(k){return Z2(k)?$fk(this,k):xP(k)?w_5(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.m(TGi,er);TGi.prototype.T=function(k){return xP(k)?iB_(this,k):LGG(k)?L9f(this,k):wn(k)?bBf(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.Y=mf_.prototype;g.Y.PFX=function(k){var n=this,t,d,G,R;return g.H(function(O){if(!g.u(k.state,128))return O.DH(0);t=k.state.fd;var D=(d=t)==null?void 0:d.errorCode,Z=(G=t)==null?void 0:G.NK;R=D==="net.connect"&&Z===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(D==null?0:D.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.q(O,n.G6(n.player.getVideoData().videoId,R),0)})};
g.Y.G6=function(k,n){var t=this;return g.H(function(d){if(d.B==1){if(t.T)return d.return();t.T=!0;return n==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(c6(t,k,!1,!0),d.DH(0)):g.q(d,rn(t,k),3)}g.FI(k,4);return g.q(d,t.B.G6(n),0)})};
g.Y.U2=function(k){k.status===2?(k.status!==this.C&&(i75(this.B),g.FI(k.videoId,2)),k.y$&&yDO(this.B,k.videoId,k.y$)):k.status===4?(rn(this,k.videoId),this.G6(k.videoId,k.Aw?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):k.status===1&&mki(this.B);this.C=k.status;this.api.A8("localmediachange",{videoId:k.videoId,status:k.status})};
g.Y.bU=function(){var k=this,n;return g.H(function(t){if(t.B==1){if(k.T)return t.return();k.T=!0;n=k.player.getVideoData().videoId;return g.q(t,rn(k,n),2)}return g.q(t,k.B.bU(),0)})};
g.Y.L_=function(k){switch(k){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.Y.G=function(k){return this.api.V().G(k)};g.m(IWG,er);IWG.prototype.T=function(k){return Z2(k)?V47(this,k):xP(k)?AK4(this,k):LGG(k)?W9W(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};jF5.prototype.B=function(k,n){var t=k.action.actionMetadata.priority-n.action.actionMetadata.priority;t===0&&(k.B<n.B?t=-1:k.B>n.B&&(t=1));return t};g.m(Na,g.N);Na.prototype.Cf=function(){this.K&&this.K();g.N.prototype.Cf.call(this)};
Na.prototype.createAction=function(k,n){var t=g.pC(k.entityKey).entityType,d=g.In(16);return new bw(t,d,k,n.actionId,n.rootActionId)};
Na.prototype.RS=function(k){var n=this,t,d,G,R,O,D,Z,x,w;return g.H(function(T){if(T.B==1){if(n.Ww())return T.return();d=(t=k.offlineOrchestrationActionWrapperEntity)!=null?t:new Set;G=[];R=g.y(d);for(O=R.next();!O.done;O=R.next())D=O.value,Z=g.pC(D),x=Z.entityId,NG9(n.B,x)||G.push(D);return g.q(T,lWO(n,G),2)}w=T.T;return g.q(T,Ckf(n,w),0)})};
Na.prototype.retry=function(){var k=this;return g.H(function(n){return g.q(n,p_4(k),0)})};k69.prototype.mx=function(k,n){n=n===void 0?!0:n;var t=this,d,G,R,O,D,Z,x,w;return g.H(function(T){switch(T.B){case 1:if(!t.B)return T.return();d=[];G=g.Gr(t.B.T,n);R=[];for(O={hA:0};O.hA<G.length;O={hA:O.hA},O.hA++)D=G[O.hA],Z=t.B.Cr(D,"json3"),x=g.qn(Z,{withCredentials:!0,format:"RAW"},3,500).then(function(J){return function(L){L={metadata:g.m0(G[J.hA]),trackData:L.xhr.responseText};R.push(L)}}(O)).Qj(function(J){GX("Caption fetch error",J)}),d.push(x);
return g.q(T,bsO(d),2);case 2:return g.Xh(T,3),g.q(T,znO(k,R),5);case 5:g.BI(T,0);break;case 3:w=g.IJ(T),GX("Caption DB transaction error",w),g.yq(T)}})};g.m(f3,g.N);f3.prototype.Cf=function(){this.T&&this.T();g.N.prototype.Cf.call(this)};
f3.prototype.C=function(k){var n=this,t,d,G,R,O,D,Z,x;return g.H(function(w){d=(t=k.transfer)!=null?t:new Set;G=[];R=g.y(d);for(O=R.next();!O.done;O=R.next())D=O.value,Z=g.pC(D),x=Z.entityId,G.push(x);return G.length===0?w.return():g.q(w,dkO(n,G),0)})};g.m(obf,g.N);g.Y=obf.prototype;g.Y.Cf=function(){this.Sm&&this.Sm();this.Lf.dispose();this.S.dispose();this.kf&&g.MV(this.L.ZD,this.kf);this.uf&&g.MV(this.L.ZD,this.uf);g.N.prototype.Cf.call(this)};
g.Y.wok=function(k){var n=this,t,d,G;return g.H(function(R){switch(R.B){case 1:t=g.S5(k,"transfer");if(n.B&&t===n.B.key){c6(n.W,n.D,!0);n.S.stop();R.DH(0);break}return g.q(R,Ce(n.T,{mode:"readwrite",PC:!0},function(O){return zi(O,t,"transfer").then(function(D){if(D&&D.transferState!=="TRANSFER_STATE_COMPLETE"&&D.transferState!=="TRANSFER_STATE_FAILED")return D.transferState="TRANSFER_STATE_PAUSED_BY_USER",vD(O,D,"transfer").then(function(){return D})})}),3);
case 3:d=R.T;if(!d){R.DH(0);break}if(!k||!n.C){R.DH(5);break}return g.q(R,TX(k,n.C,n.T,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.q(R,a4(n,k),7);case 7:G=R.T,iSk({videoId:k,TP:d,offlineModeType:G}),g.yq(R)}})};
g.Y.qmV=function(){var k=this;if(this.B&&this.D){c6(this.W,this.D,!1);var n=this.B,t=(n==null?0:n.key)?g.pC(n.key).entityId:"";t&&this.C&&(new Promise(function(d,G){TX(t,k.C,k.T,"DOWNLOAD_STATE_PAUSED").catch(function(R){G(R)})})).catch(function(d){GX("Download state setting error",d)})}this.S.stop()};
g.Y.vn=function(){this.B?Z7K(this,this.B):zX(this)};
g.Y.iQ=function(k){var n=this;return g.H(function(t){switch(t.B){case 1:if(!n.B){t.DH(2);break}if(n.B.transferState==="TRANSFER_STATE_COMPLETE"||n.B.transferState==="TRANSFER_STATE_FAILED"||!k.transfer||!k.transfer.has(n.B.key)){t.DH(3);break}return g.q(t,pe(n.T,n.B.key,"transfer"),4);case 4:n.B=t.T;if(n.B){t.DH(3);break}return g.q(t,xkO(n),3);case 3:if(n.B)return t.return();case 2:return g.q(t,zX(n),0)}})};
g.Y.G6=function(k,n){var t=this,d,G,R,O,D;return g.H(function(Z){switch(Z.B){case 1:if(!t.B){K3(t,"onTransferFailure: "+k);Z.DH(2);break}d=t.B;R=((G=d)==null?0:G.key)?g.pC(d.key).entityId:"";a:switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var x=!1;break a;default:x=!0}return x&&sb4(t)?g.q(Z,v6(t,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.q(Z,
XH9(t,k),5);case 5:if(!R||!t.C){Z.DH(2);break}return g.q(Z,TX(R,t.C,t.T,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.q(Z,a4(t,R),9);case 9:O=Z.T;D2({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:R,TP:d,offlineModeType:O});if(!R||!t.C){Z.DH(2);break}return g.q(Z,TX(R,t.C,t.T,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Q2(t),D=zX(t,!0),n&&n(D),g.yq(Z)}})};
g.Y.bU=function(k){var n=this,t,d,G,R,O,D,Z,x,w,T,J,L;return g.H(function(b){switch(b.B){case 1:if(!n.B){K3(n,"onMaybeTransferStreamsExpired");b.DH(2);break}return sb4(n)?g.q(b,v6(n,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.q(b,XH9(n,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!n.C){b.DH(2);break}t=n.B;G=((d=t)==null?0:d.key)?g.pC(t.key).entityId:"";if(!G){b.DH(2);break}return g.q(b,TX(G,n.C,n.T,"DOWNLOAD_STATE_FAILED"),2);case 9:return n.B||K3(n,"onMaybeTransferStreamsExpiredRetryAttempting"),
R=n.B,D=((O=R)==null?0:O.key)?g.pC(R.key).entityId:"",g.q(b,a4(n,D),10);case 10:return Z=b.T,D2({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:D,TP:R,offlineModeType:Z}),x=s84(),g.am(x,P6,{isEnqueuedForExpiredStreamUrlRefetch:!0}),w=g.S5(D,"playbackData"),T={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:w,actionMetadata:x},J=y2(new bw("playbackData",D,T)),g.q(b,lJ(n.T,J,"offlineOrchestrationActionWrapperEntity"),2);case 2:Q2(n),L=zX(n,!0),
k&&k(L),g.yq(b)}})};
var IaC={},EbC=(IaC.TRANSFER_STATE_TRANSFERRING=1,IaC.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,IaC);g.Y=uw.prototype;g.Y.uO=function(){return this.D.promise};
g.Y.A7=function(){if(this.T&&this.W)return this.D.promise;IE5(this).then(this.D.resolve).catch(this.D.reject);return this.D.promise};
g.Y.dc=function(k){var n={};return n.playbackData=new YSm(k,this.q3,this.B),n.transfer=new IWG(k,this.q3),n.videoPlaybackPositionEntity=new TGi(k,this.q3),n};
g.Y.xU=function(){var k=this;return g.H(function(n){return k.T?g.q(n,DkW(k.T),0):n.DH(0)})};
g.Y.jN=function(){var k=this,n,t;return g.H(function(d){if(d.B==1)return k.T||k.W?g.q(d,k.uO(),2):d.return();k.X!==void 0&&(g.yy(k.X),k.X=void 0);k.S!==void 0&&(g.yy(k.S),k.S=void 0);(n=k.T)==null||n.dispose();k.T=void 0;(t=k.W)==null||t.dispose();k.W=void 0;k.api.A8("onOrchestrationLostLeader");k.D=new g.Bo;g.yq(d)})};
g.Y.isOrchestrationLeader=function(){return this.C.B};
g.Y.HM=function(){return g.H(function(k){return k.return(!1)})};
g.Y.yk=function(k){var n=this.B;n.api.publish("offlinetransferpause",k);var t;(t=n.T)==null||t.postMessage(k)};
g.Y.vn=function(k){var n,t;return g.H(function(d){if(d.B==1)return g.q(d,kP(),2);n=d.T;if(!n)return d.return();t=g.S5(k,"transfer");return g.q(d,Ce(n,{mode:"readwrite",PC:!0},function(G){var R=zi(G,t,"transfer"),O=zi(G,g.S5(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Bh.all([R,O]).then(function(D){D=g.y(D);var Z=D.next().value;var x=D.next().value;return Z&&Z.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(Z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",vD(G,Z,"transfer").then(function(){D2({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:k,TP:Z,offlineModeType:x==null?void 0:x.offlineModeType});return g.Bh.resolve(null)})):g.Bh.resolve(null)})}),0)})};
g.Y.X_=function(k){k=k===void 0?43200:k;var n=this,t,d,G,R,O,D,Z,x;return g.H(function(w){if(w.B==1)return n.L.VF()?g.q(w,kP(),2):w.return(hw9());if(w.B!=3){t=w.T;if(!t)return w.return([]);d=Date.now()/1E3;return g.q(w,Sg(t,"offlineVideoPolicy"),3)}G=w.T;R=[];O=g.y(G);for(D=O.next();!D.done;D=O.next())Z=D.value,Number(Z.lastUpdatedTimestampSeconds)+k<=d&&(x=g.pC(Z.key).entityId,R.push(x));return R.length?w.return(Ma(n,R,n.K,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):w.return([])})};
g.Y.deleteAll=function(){return Ma(this,["!*$_ALL_ENTITIES_!*$"],this.K,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.Y.refreshAllStaleEntities=function(k){var n=this;return g.H(function(t){return t.B==1?g.q(t,n.X_(k),2):t.return(t.T)})};
g.Y.setUpPositionSyncInterval=function(k){var n=this;this.S!==void 0&&(g.yy(this.S),this.S=void 0);var t=k!=null?k:864E5;this.S=g.bo(function(){n.gE(t)},t)};
g.Y.gE=function(k){var n=this,t,d,G,R,O,D;return g.H(function(Z){switch(Z.B){case 1:return g.Xh(Z,2),g.q(Z,Nq.getInstance(),4);case 4:t=Z.T;if(!t)throw Error("prefStorage is undefined");return g.q(Z,t.get("psi"),5);case 5:d=Z.T;R=((G=d)==null?0:G.vl)?Number(d.vl)/1E3:0;O=Date.now();if(!(R+k<=O)){Z.DH(6);break}return g.q(Z,Ma(n,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.BI(Z,0);break;case 2:D=g.IJ(Z),GX("Offline manager error",D),
g.yq(Z)}})};
g.Y.Hd=function(){var k=this,n,t,d,G,R,O,D;return g.H(function(Z){if(Z.B==1)return g.q(Z,kP(),2);if(Z.B!=3)return(n=Z.T)?g.q(Z,Sg(n,"transfer"),3):Z.return([]);t=Z.T;d=[];G=g.y(t);for(R=G.next();!R.done;R=G.next())O=R.value,O.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&O.key&&(D=g.pC(O.key).entityId,d.push(D));return Z.return(AD5(k,d))})};
g.Y.q8=function(){return g.H(function(k){return k.return([])})};
g.Y.Yx=function(){return g.H(function(k){g.yq(k)})};
g.Y.C6=function(){return g.H(function(k){g.yq(k)})};g.m(W5G,er);W5G.prototype.T=function(k){return Z2(k)?H7D(this,k):xP(k)?PUk(this,k):wn(k)?jbC(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var gn=[10];g.m(Qb9,er);Qb9.prototype.T=function(k){return Z2(k)?K5K(this,k):xP(k)?vbk(this,k):wn(k)?uSO(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var aE9=[10];g.m(gbK,er);gbK.prototype.T=function(k){return xP(k)?lEm(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.m(pH4,uw);g.Y=pH4.prototype;g.Y.dc=function(k){var n=uw.prototype.dc.call(this,k);n.mainVideoEntity=new Qb9(k,this.q3,this.B);n.mainPlaylistEntity=new W5G(k,this.q3,this.B);n.mainDownloadsListEntity=new gbK(k,this.q3,this.B);return n};
g.Y.refreshAllStaleEntities=function(k,n){var t=this,d,G,R,O,D,Z,x,w,T,J,L;return g.H(function(b){switch(b.B){case 1:d=[];if(!t.q3.G("web_player_offline_playlist_auto_refresh")){b.DH(2);break}return g.q(b,So_(t,k,n),3);case 3:d=b.T;case 2:return g.q(b,Nq.getInstance(),4);case 4:return G=b.T,g.q(b,(R=G)==null?void 0:R.get("sdois"),5);case 5:return O=b.T,g.q(b,(D=G)==null?void 0:D.get("lmqf"),6);case 6:Z=b.T;if(!O){b.DH(7);break}w=d;T=w.concat;return g.q(b,kQ9(t,O,(x=Z)!=null?x:"SD",k===0),8);case 8:d=
T.call(w,b.T);case 7:return J=d,L=J.concat,g.q(b,uw.prototype.refreshAllStaleEntities.call(t,k,n),9);case 9:return d=L.call(J,b.T),b.return(d)}})};
g.Y.HM=function(k){var n,t,d,G,R,O,D,Z;return g.H(function(x){if(x.B==1)return g.q(x,kP(),2);if(x.B!=3)return(n=x.T)?g.q(x,pe(n,g.HX,"mainDownloadsListEntity"),3):x.return(!1);t=x.T;if((d=t)==null?0:(G=d.downloads)==null?0:G.length)for(R=g.S5(k,"mainVideoEntity"),O=g.y(t.downloads),D=O.next();!D.done;D=O.next())if(Z=D.value,Z.videoItem===R)return x.return(!0);return x.return(!1)})};
g.Y.q8=function(){var k=this,n,t,d,G,R,O,D,Z;return g.H(function(x){if(x.B==1)return g.q(x,kP(),2);if(x.B!=3)return(n=x.T)?g.q(x,Sg(n,"downloadStatusEntity"),3):x.return([]);t=x.T;d=[];G=g.y(t);for(R=G.next();!R.done;R=G.next())O=R.value,O.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&O.key&&(D=g.pC(O.key).entityId,d.push(D));return d.length?(Z={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},x.return(Ma(k,d,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Z))):x.return([])})};
g.Y.C6=function(){var k;return g.H(function(n){return n.B==1?g.q(n,kP(),2):(k=n.T)?g.q(n,Ce(k,{mode:"readwrite",PC:!0},function(t){return aZ(t,"mainVideoEntity").then(function(d){var G=[];d=g.y(d);for(var R=d.next();!R.done;R=d.next()){R=R.value;var O=void 0;(O=R.userState)!=null&&O.playbackPosition||(O=g.pC(R.key).entityId,O={key:g.S5(O,"videoPlaybackPositionEntity"),videoId:O,lastPlaybackPositionSeconds:"0"},G.push(vD(t,O,"videoPlaybackPositionEntity")),R.userState={playbackPosition:O.key},G.push(vD(t,
R,"mainVideoEntity")))}return g.Bh.all(G)})}),0):n.return()})};
g.Y.Yx=function(){var k,n,t,d,G,R,O,D,Z,x,w,T,J,L,b,E,B,h,W,e,P,Q,k$,M,Gb,Y$,S,a,p,X,K,zb,hk,m_,Vq,tk,DG,yD;return g.H(function(I){if(I.B==1)return g.q(I,kP(),2);if(I.B!=3){k=I.T;if(!k)return I.return();n=g.S5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.q(I,Ce(k,{mode:"readonly",PC:!0},function(V){return g.Bh.all([zi(V,n,"mainDownloadsListEntity"),zi(V,g.HX,"mainDownloadsListEntity"),aZ(V,"mainVideoEntity"),aZ(V,"mainPlaylistEntity")])}),3)}t=I.T;
d=g.y(t);G=d.next().value;R=d.next().value;O=d.next().value;D=d.next().value;Z=G;x=R;w=O;T=D;J=new Set;if((L=Z)==null?0:(b=L.downloads)==null?0:b.length)for(E=g.y(Z.downloads),B=E.next();!B.done;B=E.next())h=B.value,W=void 0,(e=(W=h.videoItem)!=null?W:h.playlistItem)&&J.add(e);if((P=x)==null?0:(Q=P.downloads)==null?0:Q.length)for(k$=g.y(x.downloads),M=k$.next();!M.done;M=k$.next())Gb=M.value,Gb.videoItem&&J.add(Gb.videoItem);Y$=new Set;S=[];a=g.y(T);for(p=a.next();!p.done;p=a.next()){X=p.value;if(X.videos)for(K=
g.y(X.videos),zb=K.next();!zb.done;zb=K.next())hk=zb.value,(m_=JSON.parse(g.pC(hk).entityId).videoId)&&Y$.add(m_);X.key&&!J.has(X.key)&&S.push(X.key)}Vq=g.y(w);for(tk=Vq.next();!tk.done;tk=Vq.next())DG=tk.value,DG.key&&!J.has(DG.key)&&(yD=g.pC(DG.key).entityId,Y$.has(yD)||S.push(DG.key));return S.length?g.q(I,FGf(k,S),0):I.DH(0)})};g.m(n0f,er);n0f.prototype.T=function(k){return Z2(k)?dd_(this,k):xP(k)?GQm(this,k):wn(k)?Rlk(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var lw=[10];g.m(YP5,er);YP5.prototype.T=function(k){return Z2(k)?Dd_(this,k):xP(k)?$dC(this,k):wn(k)?ZJ7(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var p3=[10];g.m(Ty9,er);Ty9.prototype.T=function(k){return Z2(k)?bJD(this,k):xP(k)?md9(this,k):wn(k)?y89(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var LJ5=[10];g.m(Sr,uw);Sr.prototype.dc=function(k){var n=uw.prototype.dc.call(this,k);n.musicTrack=new Ty9(k,this.B);n.musicPlaylist=new YP5(k,this.B);n.musicAlbumRelease=new n0f(k,this.B);return n};
Sr.prototype.refreshAllStaleEntities=function(k,n){var t=this,d,G,R;return g.H(function(O){if(O.B==1)return g.q(O,X$C(t,k,n),2);if(O.B!=3)return G=d=O.T,R=G.concat,g.q(O,uw.prototype.refreshAllStaleEntities.call(t,k,n),3);d=R.call(G,O.T);return O.return(d)})};g.m(E0i,g.Jz);g.Y=E0i.prototype;g.Y.create=function(){var k=this;g.f(this,this.events);g.kl(this.q3)?this.B=new pH4(this.q3,this.player):g.NO(this.q3)&&(this.B=new Sr(this.q3,this.player));this.events.J(this.player,"onPlaybackStartExternal",function(){k.VM()});
this.events.J(this.player,"videodatachange",function(){k.VM()});
this.q3.G("html5_offline_playback_position_sync")&&this.events.J(this.player,"presentingplayerstatechange",this.Mt)};
g.Y.Qt=function(){return!1};
g.Y.ll=function(k,n,t,d){var G=this;return g.H(function(R){return G.B?R.return(Ma(G.B,k,n,t,d)):R.return(Promise.reject())})};
g.Y.deleteAll=function(){return this.B.deleteAll()};
g.Y.X_=function(k){return this.B.X_(k)};
g.Y.refreshAllStaleEntities=function(k){return this.B.refreshAllStaleEntities(k)};
g.Y.setUpPositionSyncInterval=function(k){this.B.setUpPositionSyncInterval(k)};
g.Y.yk=function(k){this.B.yk(k)};
g.Y.vn=function(k){return this.B.vn(k)};
g.Y.VM=function(){var k=this,n;return g.H(function(t){n=k.player.getVideoData();return g.Sw(n)?Ud5(n)&&k.T!==n.clientPlaybackNonce?g.q(t,Byk(k,n),0):t.DH(0):t.return()})};
g.Y.Mt=function(k){var n=this,t,d,G,R,O,D,Z;return g.H(function(x){if(x.B==1)return t=n.player.getVideoData(),d=t.t8,g.LK(k,2)||g.LK(k,512)?g.q(x,kP(),2):x.return();if(x.B!=3){G=x.T;if(!G)return GX("PES is undefined"),x.return();R=t.videoId;return g.q(x,pe(G,g.S5(R,"mainVideoEntity"),"mainVideoEntity"),3)}O=x.T;if(!O)return x.return();D=Math.floor(d).toString();Z={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:D}};return g.q(x,n.ll([R],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
Z),0)})};
g.Y.isOrchestrationLeader=function(){return this.B.isOrchestrationLeader()};
g.Y.updateDownloadState=function(k,n){var t,d,G,R;return g.H(function(O){if(O.B==1)return g.q(O,kP(),2);t=O.T;if(!t)return GX("PES is undefined"),O.return();d=g.pC(k);G=d.entityType;R=d.entityId;return g.q(O,TX(R,G,t,n,!0),0)})};g.iH("offline",E0i);})(_yt_player);
